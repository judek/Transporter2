var DISQUS=function(e){var a=e.DISQUS||{};a.AssertionError=function(a){this.message=a};a.AssertionError.prototype.toString=function(){return"Assertion Error: "+(this.message||"[no message]")};a.assert=function(f,g,h){if(!f)if(h)e.console&&e.console.log("DISQUS assertion failed: "+g);else throw new a.AssertionError(g);};var f=[];a.define=function(i,g){typeof i==="function"&&(g=i,i="");for(var h=i.split("."),c=h.shift(),b=a,q=(g||function(){return{}}).call({overwrites:function(b){b.__overwrites__=!0;
return b}},e);c;)b=b[c]?b[c]:b[c]={},c=h.shift();for(var j in q)q.hasOwnProperty(j)&&(!q.__overwrites__&&b[j]!==null&&a.assert(!b.hasOwnProperty(j),"Unsafe attempt to redefine existing module: "+j,!0),b[j]=q[j],f.push(function(b,c){return function(){delete b[c]}}(b,j)));return b};a.use=function(f){return a.define(f)};a.cleanup=function(){for(var a=0;a<f.length;a++)f[a]()};return a}(window);
DISQUS.define(function(e,a){var f=e.DISQUS,i=e.document,g=i.getElementsByTagName("head")[0]||i.body,h={running:!1,timer:null,queue:[]};f.defer=function(c,b){function g(){var b=h.queue;if(b.length===0)h.running=!1,clearInterval(h.timer);for(var c=0,a;a=b[c];c++)a[0]()&&(b.splice(c--,1),a[1]())}h.queue.push([c,b]);g();if(!h.running)h.running=!0,h.timer=setInterval(g,100)};f.each=function(c,b){var g=c.length,a=Array.prototype.forEach;if(isNaN(g))for(var f in c)c.hasOwnProperty(f)&&b(c[f],f,c);else if(a)a.call(c,
b);else for(a=0;a<g;a++)b(c[a],a,c)};f.extend=function(c){f.each(Array.prototype.slice.call(arguments,1),function(b){for(var g in b)c[g]=b[g]});return c};f.serializeArgs=function(c){var b=[];f.each(c,function(c,g){c!==a&&b.push(g+(c!==null?"="+encodeURIComponent(c):""))});return b.join("&")};f.isString=function(c){return Object.prototype.toString.call(c)==="[object String]"};f.serialize=function(c,b,g){b&&(c+=~c.indexOf("?")?c.charAt(c.length-1)=="&"?"":"&":"?",c+=f.serializeArgs(b));if(g)return b=
{},b[(new Date).getTime()]=null,f.serialize(c,b);b=c.length;return c.charAt(b-1)=="&"?c.slice(0,b-1):c};f.require=function(c,b,a,e,h){function o(b){if(b.type=="load"||/^(complete|loaded)$/.test(b.target.readyState))e&&e(),n&&clearTimeout(n),f.bean.remove(b.target,r,o)}var l=i.createElement("script"),r=l.addEventListener?"load":"readystatechange",n=null;l.src=f.serialize(c,b,a);l.async=!0;l.charset="UTF-8";(e||h)&&f.bean.add(l,r,o);h&&(n=setTimeout(function(){h()},2E4));g.appendChild(l);return f};
f.requireStylesheet=function(c,b,a){var e=i.createElement("link");e.rel="stylesheet";e.type="text/css";e.href=f.serialize(c,b,a);g.appendChild(e);return f};f.requireSet=function(c,b,g){var a=c.length;f.each(c,function(c){f.require(c,{},b,function(){--a===0&&g()})})};f.injectCss=function(c){var b=i.createElement("style");b.setAttribute("type","text/css");c=c.replace(/\}/g,"}\n");e.location.href.match(/^https/)&&(c=c.replace(/http:\/\//g,"https://"));b.styleSheet?b.styleSheet.cssText=c:b.appendChild(i.createTextNode(c));
g.appendChild(b)}});
DISQUS.define("JSON",function(){function e(b){return b<10?"0"+b:b}function a(b){c.lastIndex=0;return c.test(b)?'"'+b.replace(c,function(b){var c=j[b];return typeof c==="string"?c:"\\u"+("0000"+b.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+b+'"'}function f(c,k){var e,h,i,j,l=b,o,m=k[c];m&&typeof m==="object"&&typeof m.toJSON==="function"&&!g&&(m=m.toJSON(c));typeof p==="function"&&(m=p.call(k,c,m));switch(typeof m){case "string":return a(m);case "number":return isFinite(m)?String(m):"null";case "boolean":case "null":return String(m);
case "object":if(!m)return"null";b+=q;o=[];if(Object.prototype.toString.apply(m)==="[object Array]"){j=m.length;for(e=0;e<j;e+=1)o[e]=f(e,m)||"null";i=o.length===0?"[]":b?"[\n"+b+o.join(",\n"+b)+"\n"+l+"]":"["+o.join(",")+"]";b=l;return i}if(p&&typeof p==="object"){j=p.length;for(e=0;e<j;e+=1)h=p[e],typeof h==="string"&&(i=f(h,m))&&o.push(a(h)+(b?": ":":")+i)}else for(h in m)Object.hasOwnProperty.call(m,h)&&(i=f(h,m))&&o.push(a(h)+(b?": ":":")+i);i=o.length===0?"{}":b?"{\n"+b+o.join(",\n"+b)+"\n"+
l+"}":"{"+o.join(",")+"}";b=l;return i}}var i={},g=!1;if(typeof Date.prototype.toJSON!=="function")Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()};var h=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
c=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,b,q,j={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},p;i.stringify=function(c,k,g){var a;q=b="";if(typeof g==="number")for(a=0;a<g;a+=1)q+=" ";else typeof g==="string"&&(q=g);if((p=k)&&typeof k!=="function"&&(typeof k!=="object"||typeof k.length!=="number"))throw Error("JSON.stringify");return f("",{"":c})};i.parse=function(b,c){function g(b,
a){var e,f,m=b[a];if(m&&typeof m==="object")for(e in m)Object.hasOwnProperty.call(m,e)&&(f=g(m,e),f!==void 0?m[e]=f:delete m[e]);return c.call(b,a,m)}var a,b=String(b);h.lastIndex=0;h.test(b)&&(b=b.replace(h,function(b){return"\\u"+("0000"+b.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(b.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return a=eval("("+b+")"),
typeof c==="function"?g({"":a},""):a;throw new SyntaxError("JSON.parse");};var o={a:[1,2,3]},l,r;if(Object.toJSON&&Object.toJSON(o).replace(/\s/g,"")==='{"a":[1,2,3]}')l=Object.toJSON;typeof String.prototype.evalJSON==="function"&&(o='{"a":[1,2,3]}'.evalJSON(),o.a&&o.a.length===3&&o.a[2]===3&&(r=function(b){return b.evalJSON()}));(function(){var b=[1,2,3];typeof b.toJSON==="function"&&(b=b.toJSON(),g=!(b&&b.length===3&&b[2]===3))})();if(g||!l||!r)return{stringify:i.stringify,parse:i.parse};return{stringify:l,
parse:r}});
DISQUS.define("Bus",function(){function e(c){c=c.split("/");return c[0]+"//"+c[2]}var a=DISQUS.use("JSON"),f=window.location.hash.slice(1),i=window.parent,g=document.referrer,h={};h.client=e(document.location.href);h.host=g?e(g):h.client;return{origins:h,postMessage:function(c){c.sender=f;c=a.stringify(c);i.postMessage(c,h.host)},sendHostMessage:function(c,b){b=b||[];DISQUS.Bus.postMessage({scope:"host",name:c,data:b})},sendGlobalMessage:function(c,b){b=b||[];DISQUS.Bus.postMessage({scope:"global",name:c,
data:b})}}});_.extend(DISQUS.Bus,Backbone.Events);$(document).ready(function(){var e=window.addEventListener?window.addEventListener:window.attachEvent,a=window.addEventListener?"message":"onmessage";if(!e)throw Error("No event support.");e(a,function(a){var e=DISQUS.Bus,g=a.origin;if(!(g!=e.origins.client&&g!=e.origins.host)){var h;try{h=DISQUS.JSON.parse(a.data)}catch(c){return}a=h.data;switch(h.scope){case "client":e.trigger(a.eventName,a.data)}}},!1)});
DISQUS.define(function(e,a){var f={blocks:{},ISO_8601:"YYYY-MM-DDTHH:mm:ssZ",apiKey:"E8Uh5l5fHZ6gD8U3KycjAIAk46f68Zw7C6eW8WSjZvCLXebZ7p0r1yrYDrLilk2F",bean:require("bean"),debug:!1,browser:{mobile:navigator.userAgent.match(/Android|webOS|iPhone|iPad|iPod|BlackBerry/i)},modules:{},strings:{translations:{}}};f.strings.get=_.bind(function(g){var e=this.translations[g];return e!==a?e:g},f.strings);f.interpolate=function(g,e){return g.replace(/%\(\w+\)s/g,function(c){var c=c.slice(2,-2),b="";c in e?b=
e[c]!==a&&e[c]!==null?e[c].toString():"":DISQUS.logError&&DISQUS.logError("Key `"+c+"` not found in context for: ",g);return b})};f.addBlocks=function(){return function(g){g(DISQUS)}};f.templateGlobals={urls:DISQUS.use("urls"),sso:null,trans:f.strings.get};f.renderBlock=function(g,a){return DISQUS.blocks[g](f.templateGlobals,a)};f.assureOffset=function(g){return g.indexOf("+")>=0?g:g+"+00:00"};var i=f.Builder=function(){this.accum=[]};_.extend(i.prototype,{put:function(g){this.accum.push(g)},esc:function(g){return String(g).replace(/&/g,
"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},compile:function(){return this.accum.join("")}});return f});
DISQUS.define("urls",function(){var e=DISQUS.debug?"/js/src/embed/next/vglnk.js":"/build/next/alfie.js",a=encodeURIComponent(document.referrer),f={root:"http://disqus.com",media:"http://mediacdn.disqus.com/1351791231",loading:"http://mediacdn.disqus.com/1351791231/html/simple-loading.html",realertime:"http://realtime.services.disqus.com",login:"https://disqus.com/next/login/",api:"http://disqus.com/api/3.0/",apiSecure:"https://disqus.com/api/3.0/",logout:"http://disqus.com/logout/?redirect="+a,editProfile:"http://disqus.com/account/",
verifyEmail:"https://disqus.com/next/verify/",authorize:"https://disqus.com/api/oauth/2.0/authorize/",moderate:"http://disqus.com/admin/moderate/",oauth:{twitter:"http://disqus.com/_ax/twitter/begin/",google:"http://disqus.com/_ax/google/begin/",facebook:"http://disqus.com/_ax/facebook/begin/"},avatar:{generic:"http://mediacdn.disqus.com/1351791231/images/noavatar92.png"},linkAffiliatorClient:"http://mediacdn.disqus.com/1351791231"+e};window.location.protocol==="https:"&&(f=_.extend(f,{root:"https://disqus.com",
media:"https://securecdn.disqus.com/1351791231",loading:"https://securecdn.disqus.com/1351791231/html/simple-loading.html",realertime:f.realertime.replace("http://","https://"),api:f.apiSecure,logout:"https://disqus.com/logout/?redirect="+a,editProfile:"https://disqus.com/account/",moderate:"https://disqus.com/admin/moderate/",oauth:{twitter:"https://disqus.com/_ax/twitter/begin/",google:"https://disqus.com/_ax/google/begin/",facebook:"http://disqus.com/_ax/facebook/begin/"},avatar:{generic:"https://securecdn.disqus.com/1351791231/images/noavatar92.png"},
linkAffiliatorClient:"https://securecdn.disqus.com/1351791231"+e}));return f});
DISQUS.define("api",function(){function e(a){function g(c){var f=c.originalEvent.origin;DISQUS.urls.apiSecure.slice(0,f.length)===f&&(c=DISQUS.JSON.parse(c.originalEvent.data),c.requestId==e&&(f=c.code===0?a.success:a.error,delete c.requestId,(f||function(){})(c),document.body.removeChild(j),document.body.removeChild(b),$(window).unbind("message",g)))}var e=_.uniqueId(),c=document.createElement("div"),b=document.createElement("form"),f="frame_"+e,j;c.innerHTML='<iframe name="'+f+'"></iframe>';j=c.childNodes[0];
b.target=f;b.action=a.url.replace(".json",".pm");b.method=a.method||"GET";a.data=_.extend(a.data,{callback:e,referrer:document.referrer});_.each(a.data,function(c,a){c===!0?c=[1]:c===!1?c=[0]:c===null?c=[""]:_.isArray(c)||(c=[c]);_.each(c,function(c){var g=document.createElement("input");g.type="hidden";g.name=a;g.value=c;b.appendChild(g)})});$(window).bind("message",g);document.body.appendChild(j);document.body.appendChild(b);b.submit()}function a(a){a=_.defaults(a,f);a.data=a.data||{};a.data.api_key=
DISQUS.apiKey;$.ajax(a)}var f={};return{defaults:function(a){_.extend(f,a)},getURL:function(a,g){g=g||{};if(g.secure||window.location.protocol==="https:")return DISQUS.urls.apiSecure+a;return DISQUS.urls.api+a},ajax:a,call:function(f,g){g=g||{};g.url=DISQUS.api.getURL(f,{secure:g.secure});g.data=_.extend(g.data||{},{api_key:DISQUS.apiKey});(g.secure?e:a)(g)}}});
(function(e){e.ajax=function(a){a.method=a.type;a.type=a.dataType;delete a.dataType;return DISQUS.api.ajax(a)};e.Collection.prototype.parse=function(a){return a.response}})(Backbone);
DISQUS.define("ga",function(e){var a,f=function(g){a?a(g):e._gaq.push(g)},i={component:1,"package":2,forum:3,version:4,userType:5};return{setCaller:function(g){a=g},setAccount:function(a){f(["_setAccount",a])},setCustomVar:function(a,e){f(["_setCustomVar",i[a],a,e])},trackPageview:function(){f(["_trackPageview"])},trackEvent:function(a,e,c){f(["_trackEvent",e,a,c,1])},setDomainName:function(a){f(["_setDomainName",a])}}});
DISQUS.define("juggler",function(e){var a,f,i={},g=["thread","forum","forum_id"],h=g.slice().concat(["imp","event","prev_imp"]),c=[],b=(new Date).getTime().toString(10)+Math.floor(Math.random()*1E6).toString(10);return{load:function(h){function j(){a=function(){};c=[]}f=h.url;if(h.disable)return void j();if(e.location.protocol==="https:"){if(h.disableSSL)return void j();f=f.replace("http:","https:")}DISQUS.each(g,function(b){i[b]=h[b]});i.imp=b;i.prev_imp=DISQUS.cookies.read("__jid");DISQUS.cookies.create("__jid",
b,{expiresIn:18E5});a=function(b){DISQUS.each(i,function(c,a){b[a]=i[a]});DISQUS.require(f,b,!1)};DISQUS.each(c,function(b){a(b)})},emit:function(b,e){DISQUS.each(h,function(b){if(e[b]!=null)throw"Error: cannot overwrite event context '"+b+"'";});e.event=b;a==null?c.push(e):a(e)},impId:b}});
DISQUS.define("intelligence",function(e){function a(a,e){function g(b){if(!(b instanceof DISQUS.lounge.models.User)&&!(b instanceof DISQUS.lounge.models.AnonUser))throw Error("determineUserType(user) needs an instance of User/Anonuser");return b.has("remote")?b.get("remote").domain:b.id?"disqus":r?"guest":"not_logged_in"}function h(b){if(e.switches.length>0)b(e.switches);else e.switches.on("reset",b)}var c=e.initialData;if(_.isObject(c)&&!_.isEmpty(c)){var b=DISQUS.ga.setCustomVar,q=DISQUS.ga.trackPageview,
j=function(b){DISQUS.ga.trackEvent(b,p,o)},p="next",o=c.forum.id,l="not_logged_in",r=!1,n=c.features.support_preferred?"plus":c.features.support_priority?"pro":c.features.support_vip?"vip":"free";e.session.on("identify",function(){var k=this.user;h(function(b){b.enabled("juggler_thread_onReady")&&DISQUS.juggler.emit("init_embed",{thread_slug:c.thread.slug,user_type:k.get("user_type")||"anon",referrer:a.document.referrer,theme:"next"})});l=g(k);b("component","embed");b("package",n);b("forum",o);b("version",
p);b("userType",l);q();e.session.on("change:id",function(c){var a=l;l=g(c);a!=l&&(b("userType",l),j(l=="not_logged_in"||l=="guest"?"logout":"login"))})});h(function(b){DISQUS.juggler.load({disable:!b.enabled("juggler_enabled"),url:"http://juggler.services.disqus.com/event.js",disableSSL:b.enabled("next_disable_ssl_juggler"),thread:c.thread.id,forum:c.forum.id,forum_id:c.forum.pk})});DISQUS.each({inViewport:function(){j("view_embed");e.off("inViewport")},"uiAction:createPost":function(c){l=="not_logged_in"&&
(l="guest",b("userType",l));r=!0;c.get("parent")!=null?j("post_comment_reply"):j("post_comment")},"uiAction:postUpvote":function(){j("like_comment")},"uiAction:postDownvote":function(){j("dislike_comment")},"uiAction:threadUpvote":function(){j("like_thread")},"uiAction:postShare":function(b){j("share_comment_"+b)},"uiAction:threadShare":function(b){j("share_thread_"+b)},"uiAction:navigate":function(b){(b={community:"community",dashboard:"mydisqus",profile:"profile",reactions:"reactions"}[b])&&j("open_"+
b)},"uiAction:followUser":function(){j("follow_user")}},function(b,c){e.on(c,b)})}}return{init:function(f){a(e,f)}}});
DISQUS.define("cookies",function(){return{create:function(e,a,f){e=e+"="+a+"; path=/";f.domain&&(e+="; domain=."+f.domain);f.expiresIn&&(a=new Date,a.setTime(a.getTime()+f.expiresIn),e+="; expires="+a.toGMTString());document.cookie=e},read:function(e){e+="=";for(var a=document.cookie.split(";"),f,i=0;i<a.length;i++){for(f=a[i];f.charAt(0)==" ";)f=f.substring(1,f.length);if(f.indexOf(e)===0)return f.substring(e.length,f.length)}return null},erase:function(e,a){var f=new Date;f.setTime(f.getTime()+
-864E5);f=e+"=; path=/;expires="+f.toGMTString();a.domain&&(f+="; domain=."+a.domain);document.cookie=f}}});
DISQUS.define("lounge.utils",function(){function e(c){function b(b){b=Number(b).toString(16);return b.length==1?"0"+b:b}if(c.substr(0,1)==="#")return c;var a=/.*?rgb\((\d+),\s*(\d+),\s*(\d+)\)/.exec(c);if(!a||a.length!==4)return"";var c=b(a[1]),e=b(a[2]),a=b(a[3]);return"#"+c+e+a}var a=RegExp("[\\u0021-\\u002F\\u003A-\\u0040\\u005B-\\u0060\\u007B-\\u007E\\u00A1-\\u00BF\\u2010-\\u2027\\u2030-\\u205E\\u2300-\\u23FF\\u2E00-\\u2E7F\\u3001-\\u303F\\uFE10-\\uFE19\\uFE30-\\uFE4F\\uFE50-\\uFE6B\\uFF01-\\uFF0F\\uFF1A-\\uFF20\\uFF3B-\\uFF40\\uFF5B-\\uFF60\\uFF5F-\\uFF64]+$"),f=
{domain:DISQUS.urls.root.split("/")[2],create:function(c,b){DISQUS.cookies.create(c,b,{domain:f.domain,expiresIn:31536E6})},read:DISQUS.cookies.read,erase:function(c){DISQUS.cookies.erase(c,{domain:f.domain})}},i=function(){var c={};return{getItem:function(b){return c.hasOwnProperty(b)?c[b]:null},setItem:function(b,a){c[b]=String(a)},removeItem:function(b){delete c[b]}}}(),g=/^[a-z0-9_.%+\-]+@[0-9a-z.\-]+\.[a-z.]{2,6}$/i,h=function(){function c(){this.state=null;this.queue=[]}_.extend(c.prototype,
{highlight:function(b){this.state===null&&this._load();this.queue.push(b);this.state===2&&this._flush()},_load:function(){var b=this;b.state=1;DISQUS.require("http://mediacdn.disqus.com/1351791231/build/js/highlight.js",{},!1,function(){b.state=2;b._flush()})},_flush:function(){_.chainedDefer(this.queue,function(b){var c=$(b).html();$(b).html(c.replace(/^<br>/,""));hljs.highlightBlock(b)},this)}});return new c}();return{attempt:function(c,b){try{_.bind(c,b||{})()}catch(a){return a}return null},extract:function(c,
b){for(var a=b.split("."),e=a.shift();e;){if(a.length===0)return c[e];if(!_.isObject(c[e]))return;c=c[e];e=a.shift()}return c},addStylesheetRules:function(c){function b(){var e=_.find(document.styleSheets,function(b){return(b.ownerNode||b.owningElement).id===a});if(!e)return void setTimeout(b,50);for(var g=0,f=c.length;g<f;g++){var h=1,i=c[g],k=i[0],j="";Object.prototype.toString.call(i[1][0])==="[object Array]"&&(i=i[1],h=0);for(var w=i.length;h<w;h++){var v=i[h];j+=v[0]+":"+v[1]+(v[2]?" !important":
"")+";\n"}e.insertRule?e.insertRule(k+"{"+j+"}",e.cssRules.length):e.addRule(k,j,-1)}}var a="css_"+(new Date).getTime(),e=document.createElement("style");e.id=a;document.getElementsByTagName("head")[0].appendChild(e);window.createPopup||e.appendChild(document.createTextNode(""));b()},escapeColor:function(c){return e(c).replace(/[^#A-Fa-f0-9]/g,"")},makeCORSRequest:function(c,b,a){a=a||function(){};if(typeof XMLHttpRequest=="undefined")return null;var e=new XMLHttpRequest;if("withCredentials"in e)e.open(c,
b,!0),e.onreadystatechange=a;else if(typeof XDomainRequest!="undefined"){if(c!=="GET"&&c!=="POST")return null;e=new XDomainRequest;e.open(c,b);e.onload=a}else e=null;return e},hashStorage:i,cookies:f,niceTruncate:function(c,b){if(c.length<=b)return c;var e=c=c.slice(0,b-1),g=/(^.*\S)\s/.exec(c);g&&(c=g[1]);(g=a.exec(c))&&(c=c.slice(0,c.length-g[0].length));c.length<0.5*e.length&&(c=e);return c+"\u2026"},htmlDecode:function(c){var b=document.createElement("div");b.innerHTML=c;return b.childNodes.length===
0?"":b.childNodes[0].nodeValue},isWindowClosed:function(c){if(!c)return!0;try{return c.closed||c.closed===void 0}catch(b){return!0}},validateEmail:function(c){return g.test(c)},updateURL:function(c,b){var a=document.createElement("a"),b=b||{};a.href=c;b.hostname&&b.hostname.match(/\.$/)&&(b.hostname+=a.hostname);a=_.extend({protocol:a.protocol,hostname:a.hostname,pathname:a.pathname,search:a.search},b);if(!a.pathname.match(/^\//))a.pathname="/"+a.pathname;return a.protocol+"//"+a.hostname+a.pathname+
a.search},syntaxHighlighter:h}});
DISQUS.define("lounge.realtime",function(){function e(a){this.url=a+"?"+ +new Date;this.xhr=null;this.len=0}function a(a){this.uid=+new Date;this.url=a;this.main=null;this.data=[];this.c1=new f("c1",a+"?"+this.uid+"_c1");this.c2=new f("c2",a+"?"+this.uid+"_c2");this.chaos=!1;this.interval=1;_([this.c1,this.c2]).each(_.bind(function(a){a.on("progress",this.onProgress,this);a.on("error",this.onError,this);a.on("success",this.onSuccess,this)},this))}function f(a,e){this.name=a;this.url=e;this.xhr=null}
var i=DISQUS.use("lounge.utils");_.extend(e.prototype,Backbone.Events,{onLoad:function(){var a=this.xhr;a.readyState!==void 0&&a.readyState!=4||a.status!==void 0&&a.status!==200||this.trigger("success")},onError:function(){this.trigger("error")},onProgress:function(){var a=this,e=a.xhr.responseText,c=0;e&&a.len!==e.length&&(e=e.slice(a.len).split("\n"),_.each(e,function(b){c+=b.length+1;try{b=JSON.parse(b)}catch(e){c-=b.length+1;return}a.trigger("progress",b)}),a.len+=c)},run:function(){var a=this;
a.xhr=i.makeCORSRequest("GET",a.url,function(){a.onLoad()});a.xhr.onerror=function(){a.onError()};a.xhr.onprogress=function(){a.onProgress()};try{a.xhr.send()}catch(e){DISQUS.log("Attempt to send a CORS request failed.")}}});_.extend(a.prototype,Backbone.Events,{run:function(a){a=a||"c1";if(!(this.chaos&&a!=="c1"))this.main=a,this[a].run(),DISQUS.log("RT: started a new connection "+a),this.chaos?(DISQUS.logError("RT: chaos mode"),this.interval<=120&&(this.interval*=2),_.delay(_.bind(this.run,this,
"c1"),85E3,"c1")):_.delay(_.bind(this.run,this,a=="c1"?"c2":"c1"),85E3)},onProgress:function(a,e){this.main===a&&this.trigger("progress",e)},onError:function(){this.chaos=!0},onSuccess:function(){this.chaos=!1}});_.extend(f.prototype,Backbone.Events,{run:function(){var a=this,e=0,c;c=i.makeCORSRequest("GET",a.url,function(){c.readyState!==void 0&&c.readyState!==4||(c.status!==void 0&&c.status!==200&&a.trigger("error"),a.trigger("success"))});c.onerror=function(){a.trigger("error")};c.onprogress=function(){if(c.responseText){var b=
c.responseText.split("\n"),f,j;if(b.length!==e)for(;e<b.length;){if(f=i.attempt(function(){j=JSON.parse(b[e])}))break;e+=1;a.trigger("progress",a.name,[j])}}};c.send();a.xhr=c}});return{Firehose:e,Pool:a,Connection:f}});
DISQUS.define("lounge.models",function(){function e(a,b,c){var f=e.pool(a),k=b&&b[a.prototype.idAttribute];if(!k)return new a(b,c);e.get(a,k)?f[k].set(b):f[k]=new a(b,c);return f[k]}var a=DISQUS.use("lounge.collections"),f=DISQUS.use("lounge.utils"),i=DISQUS.use("Bus"),g=DISQUS.strings.get;e.pool={};e.pool=function(a){a=e.pool[a.__type__];if(!a)throw Error("Model not registered. Use UniqueModel.addType");return a};e.get=function(a,b){return e.pool(a)[b]};e.addType=function(a,b){if(!b.__type__||!e.pool[a])b.__type__=
a,e.pool[a]={}};var h=Backbone.Model.extend({defaults:{settings:{}}}),c={getRelativeCreatedAt:function(){var a=this.get("createdAt");if(a)return a=DISQUS.assureOffset(a),moment(a,DISQUS.ISO_8601).fromNow()}},b=Backbone.Model.extend({defaults:{author:null,category:null,createdAt:null,forum:null,identifiers:[],ipAddress:null,isClosed:!1,isDeleted:!1,hasStreaming:!1,link:null,message:null,slug:null,title:null,userSubscription:!1,posts:0,reactions:0,likes:0,dislikes:0,userScore:0},initialize:function(b,
c){var e=this,c=c||{};e.moderators=c.moderators;e.forum=c.forum;e.users=new a.UserCollection(c.users,{thread:e});e.posts=new a.PostCollection(c.posts,{thread:e,cursor:c.postCursor});e.reactions=new a.ReactionsCollection(null,{thread:e});e.votes=new a.ThreadVoteCollection;e.posts.bind("add reset",function(a){a=a.models?a.models:[a];_.each(a,function(a){e.users.get(a.author.id)||e.users.add(a.author)})});e.posts.bind("destroy",function(){e.set("posts",e.get("posts")-1)});e.bind("change:posts",e.broadcastPostCount,
e);e.queue=new a.QueuedPostCollection(null,{thread:e})},_vote:function(a,b){var c=a-b;if(c===0)return c;this.set("likes",this.get("likes")+c);return c},vote:function(a){var b=this;b._vote(a,b.get("userScore"))!==0&&(this.set("userScore",a),DISQUS.api.call("threads/vote.json",{data:{thread:this.id,vote:a},method:"POST",success:function(c){c.response.id&&(b.votes.get(c.response.id)||b.votes.add({id:c.response.id,score:a}))}}))},broadcastPostCount:function(){i.sendGlobalMessage("lounge.updateCounter",
{count:this.get("posts")})},fetch:function(a){var b=this,c=b.attributes,a=a||{};DISQUS.api.call("threads/details.json",{data:{thread:c.identifier?"ident:"+c.identifier:"link:"+c.url,forum:c.forum},success:function(c){b.set(c.response);a.success&&a.success()},error:function(){DISQUS.debug?b.save({},{success:a.success}):console.log("Couldn't find thread; not creating in production.")}})},_toggleState:function(a,b){b||(b={});var c=a?"open.json":"close.json";this.set("isClosed",!a);DISQUS.api.call("threads/"+
c,{method:"POST",data:{thread:this.id},success:b.success,error:b.error})},open:function(a){this._toggleState(!0,a)},close:function(a){this._toggleState(!1,a)},sync:function(){var a=this,b=a.attributes;DISQUS.api.call("threads/create.json",{data:{title:b.title,forum:b.forum,identifier:b.identifier,url:b.url},method:"POST",success:function(b){a.set(b.response)}})},incrementPostCount:function(a){this.set("posts",this.get("posts")+a)},isModerator:function(a){if(this.moderators)return a=a instanceof n||
_.isObject(a)?a.id:a,a=parseInt(a,10),_(this.moderators).contains(a)},subscribe:function(a,b){var a=a!==!1,c=this.get("userSubscription");if(c!=a){a?this.set("userSubscription",b||!0):this.set("userSubscription",!1);var e={thread:this.id};if(b)e.email=b;else if(!a&&typeof c==="string")e.email=c;DISQUS.api.call("threads/"+(a?"subscribe.json":"unsubscribe.json"),{data:e,method:"POST"})}},relatedIds:function(){var a=this.get("forum");_.isObject(a);return{forum:this.get("forum"),thread:this.id}},twitterText:function(a){var a=
140-(a.length+1),b=DISQUS.lounge.utils.htmlDecode(this.get("title"));return b=DISQUS.lounge.utils.niceTruncate(b,a)},url:function(){var a=this.get("url")||this.get("link");if(!a&&this.currentUrl)a=this.currentUrl;return a}}),q=b.extend({defaults:_.extend({postsInInterval:0,topPost:null},b.prototype.defaults)}),j=Backbone.Model.extend({defaults:function(){return{createdAt:moment().format(DISQUS.ISO_8601),dislikes:0,isApproved:!0,isDeleted:!1,isEdited:!1,isFlagged:!1,isHighlighted:!1,isRealtime:!1,
isImmediateReply:!1,isMinimized:null,message:null,raw_message:null,likes:0,media:[],parent:null,points:0,depth:0,userScore:0}},initialize:function(){this.votes=new a.VoteCollection;this.usersTyping=new a.TypingUserCollection},set:function(a,b,c){if(a&&typeof a!=="string"&&a.author)this.author=new e(n,a.author),delete a.author;return Backbone.Model.prototype.set.call(this,a,b,c)},messageText:function(){var a=this.get("message");return _.strip(a)},relatedIds:function(){var a=this.get("forum");if(_.isObject(a))a=
a.id;var b=this.get("thread");if(_.isObject(b))b=b.id;return{forum:a,thread:b,post:this.id}},twitterText:function(a){var b=140,c;c=this.author.get("name")||this.author.get("username");b-=c.length+3;b-=a.length+1;b-=2;a=this.messageText();a=DISQUS.lounge.utils.niceTruncate(a,b);return'"'+a+'" \u2014 '+c},toJSON:function(){var a=Backbone.Model.prototype.toJSON.call(this);a.isMinimized=this.get("isMinimized")===!1?!1:!this.get("isApproved");if(this.author)a.author=this.author.toJSON();a.relativeCreatedAt=
this.getRelativeCreatedAt();a.formattedCreatedAt=this.getFormattedCreatedAt();return a},getFormattedCreatedAt:function(){var a=this.get("createdAt");if(!a)return null;a=DISQUS.assureOffset(a);return moment.utc(a,DISQUS.ISO_8601).local().format("MMMM Do YYYY, h:mm:ss a")},validate:function(a){if(!this.id&&!a.id){if(_.isString(a.raw_message)){if(a.raw_message==="")return g("Comments can't be blank.");if(a.raw_message.length<2)return g("Comments must have at least 2 characters.")}if(a.author_email===
""&&a.author_name==="")return g("Please sign in or enter a name and email address.");else if(a.author_email===""||a.author_name==="")return g("Please enter both a name and email address.");if(_.isString(a.author_email)&&!f.validateEmail(a.author_email))return g("Invalid email address format.")}},report:function(){this.set("isFlagged",!0);DISQUS.api.call("posts/report.json",{data:{post:this.id},method:"POST"})},_vote:function(a,b){function c(a){f.set("likes",f.get("likes")+a)}function e(a){f.set("dislikes",
f.get("dislikes")+a)}var f=this,k=a-b;if(k===0)return k;f.set("points",f.get("points")+k);a>0?(c(a),e(b)):a<0?(e(-a),c(-b)):b>0?c(-b):e(b);return k},vote:function(a){var b=this;b._vote(a,b.get("userScore"))!==0&&(b.set("userScore",a),DISQUS.api.call("posts/vote.json",{data:{post:b.id,vote:a},method:"POST",success:function(a){b.votes.add({id:a.response.id})}}))},_delete:function(){this.set({isApproved:!1,isDeleted:!0});DISQUS.api.call("posts/remove.json",{data:{post:this.id},method:"POST"})},spam:function(){this.set({isApproved:!1,
isDeleted:!0,isSpam:!0});this.trigger("spam");DISQUS.api.call("posts/spam.json",{data:{post:this.id},method:"POST"})},_create:function(a,b){var c=this,e=a.attributes,f={thread:e.thread,message:e.raw_message};if(e.recaptcha_challenge_field)f.recaptcha_challenge_field=e.recaptcha_challenge_field,f.recaptcha_response_field=e.recaptcha_response_field;if(e.parent)f.parent=e.parent;if(e.author_name)f.author_name=e.author_name,f.author_email=e.author_email;DISQUS.api.call("posts/create.json",{data:f,method:"POST",
success:function(a){c.set(a.response);b.success&&b.success()},error:b.error})},_update:function(a,b){var c=this,e=a.attributes;DISQUS.api.call("posts/update.json",{data:{post:e.id,message:e.raw_message},method:"POST",success:function(a){c.set(a.response);b.success&&b.success()},error:b.error})},_read:function(a,b){var c=this,b=b||{};DISQUS.api.call("posts/details.json",{data:{post:c.id},method:"GET",success:function(a){c.set(a.response);b.success&&b.success()},error:b.error})},sync:function(a,b,c){var c=
c||{},e=c.error;if(e)c.error=function(a){e(JSON.parse(a.responseText||"{}"))};switch(a){case "create":this._create(b,c);break;case "update":this._update(b,c);break;case "delete":this._delete();break;case "read":this._read(b,c)}}});_.extend(j.prototype,c);e.addType("Post",j);var p=Backbone.Model.extend({defaults:{userId:null,message:null,parentId:null,immedReply:!1},initialize:function(){this.set("createdAt",moment().format(DISQUS.ISO_8601))},getVisibleParent:function(a){for(var b=this,c;b.get("parentId");){if(c=
a.posts.get(b.get("parentId")))return c;b=a.queue.get(b.get("parentId"));if(!b)break}return null},toPost:function(a){var b=a.posts.get(this.get("parentId")),b=b?b.get("depth")+1:0,b=new e(j,{id:this.id,thread:a.id,message:this.get("message"),parent:this.get("parentId"),depth:b,createdAt:this.get("createdAt"),isRealtime:!0,isImmediateReply:this.get("immedReply")});b.author=a.users.get(this.get("userId"));return b}}),o=Backbone.Model.extend({defaults:{typing:!0},initialize:function(){this.createdAt=
moment()}}),l=Backbone.Model.extend({defaults:{about:null,avatar:{cache:DISQUS.urls.media+"/images/noavatar92.png",permalink:DISQUS.urls.media+"/images/noavatar92.png"},connections:{},email:null,emailHash:null,isAnonymous:!0,isFollowedBy:!1,isFollowing:!1,joinedAt:null,name:null,profileUrl:null,url:null,username:null,numPosts:null,numFollowing:null,numFollowers:null,numLikesReceived:null},hasValidAvatar:function(a){if(!a)a=this.attributes;return(a=a.avatar)&&a.cache},validate:function(a){if(!this.hasValidAvatar(a))return"None of the avatar related properties can be null, undefined or empty on User models."},
toJSON:function(){var a=Backbone.Model.prototype.toJSON.apply(this,arguments);a.thread={};if(!this.hasValidAvatar())a.avatar=this.defaults.avatar;return a}}),r=l.extend({idAttribute:"emailHash"});e.addType("AnonUser",r);var n=l.extend({fetch:function(a){var b=this,a=a||{};DISQUS.api.call("users/details.json",{data:b.id?{user:b.id}:{},success:function(c){c=c.response;b.set(c);a.success&&a.success(c);a.complete&&a.complete(c)},error:function(b){a.error&&a.error(b);a.complete&&a.complete(b)}})},toJSON:function(){var a=
l.prototype.toJSON.call(this),b=this.collection&&this.collection.thread;a.thread.canModerate=!!b&&b.isModerator(this);return a},follow:function(){var a=this;DISQUS.api.call("users/follow.json",{data:{target:this.id},method:"POST",success:function(){a.set("isFollowing",!0)}})},unfollow:function(){var a=this;DISQUS.api.call("users/unfollow.json",{data:{target:this.id},method:"POST",success:function(){a.set("isFollowing",!1)}})}});e.addType("User",n);var k=n.extend({defaults:_.extend({numPosts:0},n.prototype.defaults)}),
y=function(){var b=Backbone.Model.extend({defaults:{canReply:!0,canModerate:!1,mustVerifyEmail:!1,isReadOnly:!1,audienceSyncVerified:!1,notificationCount:null},initialize:function(){this.user=new e(r);if("defineProperty"in Object)try{_.each(_.keys(b.prototype.defaults),function(a){var b=_.bind(function(){var b="Deprecated SessionModel accessor: "+a+". Use session.get(param) instead.";DISQUS.log&&DISQUS.log(b);Raven&&Raven.captureMessage&&Raven.captureMessage({name:"Warning",message:b});return this.get(a)},
this);Object.defineProperty(this,a,{get:b})},this)}catch(a){}},_eventProxy:function(){this.trigger.apply(this,arguments)},_setProxy:function(){this.user.on("all",this._eventProxy,this)},_clearProxy:function(){this.user&&this.user.off("all",this._eventProxy,this)},_setUser:function(b){this._clearProxy();this.user=b;this._setProxy();this.notifications=new a.NotificationCollection(null,{user:this.user});this.notifications.on("markRead",function(){this.set("notificationCount",0)},this);this.trigger("change:id",
b)},isRegistered:function(){return this.user instanceof n},isAnonymous:function(){return this.user instanceof r},toJSON:function(){var a=this.user.toJSON.apply(this.user,arguments);a.thread.canReply=this.get("canReply");if(!a.thread.canModerate)a.thread.canModerate=this.get("canModerate");return a},fetch:function(a){var b=this,a=a||{thread:{}},c={thread:a.thread.id,post:a.thread.posts.pluck("id")};c["_"+(new Date).getTime()]=1;DISQUS.api.call("embed/threadDetails.json",{data:c,success:function(c){var c=
c.response,f={};c.user&&_.extend(f,c.user,{votes:c.votes});f.id&&(b.set(c.session),b._setUser(new e(n,f)),a.thread.users.add(b.user),c.thread&&(a.thread.set("userScore",c.thread.userScore),a.thread.set("userSubscription",c.thread.userSubscription)));a.success&&a.success(c);a.complete&&a.complete(c)},error:function(b){a.error&&a.error(b);a.complete&&a.complete(b)}})},register:function(a,b){var c=this;DISQUS.api.call("internal/users/register.json",{secure:!0,data:{display_name:a.name,email:a.email},
method:"POST",success:function(a){c._setUser(new e(n,a.response))},error:b.error||function(){}})},logout:function(){var a=this;DISQUS.api.call("internal/users/logout.json",{method:"POST",success:function(){a._setUser(new e(r))}})}}),c;return{get:function(){return c=c||new b},setDefaults:function(a){if(c)throw Error("Session defaults cannot be changed after a session instance is created!");return b.defaults=_.extend(b.prototype.defaults,a)},forget:function(){c=null}}}(),w=Backbone.Model.extend({defaults:{score:0}}),
v=Backbone.Model.extend({defaults:{score:0}}),z=Backbone.Model.extend({defaults:function(){return{object:{},type:"",createdAt:moment().format(DISQUS.ISO_8601)}},toJSON:function(){var a=Backbone.Model.prototype.toJSON.call(this),b=DISQUS.assureOffset(this.get("createdAt"));a.relativeCreatedAt=moment(b,DISQUS.ISO_8601).fromNow();return a}}),B=Backbone.Model.extend({defaults:function(){return{sender:"",timestamp:moment().valueOf(),type:0,formatted:"",theme:"",createdAt:null,post:null}},set:function(a,
b){if(a&&typeof a!=="string"&&a.post)this.post=new j(a.post),delete a.post;return Backbone.Model.prototype.set.call(this,a,b)},toJSON:function(){var a=Backbone.Model.prototype.toJSON.call(this);if(this.post)a.post=this.post.toJSON();a.relativeCreatedAt=this.getRelativeCreatedAt();return a}});_.extend(B.prototype,c);var c=Backbone.Model.extend({defaults:{enabled:!1}}),E=Backbone.Model.extend({defaults:{thread:null,forum:null,body:null,service:{url:null,name:null},url:null,title:null},set:function(a,
b){if(a&&typeof a!=="string"){if(a.author)this.author=new e(a.author.id?n:r,a.author),delete a.author;if(a.createdAt)a.relativeCreatedAt=moment(DISQUS.assureOffset(a.createdAt),DISQUS.ISO_8601).fromNow()}return Backbone.Model.prototype.set.call(this,a,b)},toJSON:function(){var a=Backbone.Model.prototype.toJSON.call(this);if(this.author)a.author=this.author.toJSON();return a},destroy:function(){DISQUS.api.call("reactions/remove.json",{data:{reaction:this.id,forum:this.get("forum")},method:"POST"})}});
return{UniqueModel:e,Forum:h,Thread:b,TopThread:q,Post:j,QueuedPost:p,Reaction:E,TypingUser:o,User:n,AnonUser:r,Session:y,TopUser:k,Vote:w,ThreadVote:v,Notification:B,ActivityItem:z,Switch:c}});
DISQUS.define("lounge.collections",function(){var e=DISQUS.use("lounge.models"),a=DISQUS.use("lounge.utils"),f=Backbone.Collection.extend({model:e.ThreadVote}),i=Backbone.Collection.extend({model:_.bind(e.UniqueModel,{},e.User),initialize:function(a,b){Backbone.Collection.prototype.initialize.apply(this,arguments);this.thread=b&&b.thread}}),g=Backbone.Collection.extend({model:e.Vote}),h=Backbone.Collection.extend({PER_PAGE:10,initialize:function(a,b){b=b||{};this.cursor=b.cursor||{}},fetch:function(a){a=
a||{};a.data=_.defaults(a.data||{},{cursor:a.cursor||"",limit:this.PER_PAGE});return Backbone.Collection.prototype.fetch.call(this,a)},more:function(a){function b(a){e.push(a)}var c=this;if(this.cursor.hasNext){var e=[];this.on("add",b);this.fetch(_.extend({},a||{},{add:!0,cursor:this.cursor.next,success:function(){c.trigger("add:many",e,c,a);c.off("add",b);a.success&&a.success()}}))}else a.error&&a.error()},parse:function(a){this.cursor=a.cursor;return Backbone.Collection.prototype.parse.call(this,
a)}}),c=h.extend({model:e.Notification,url:DISQUS.api.getURL("messagesx/list"),initialize:function(a,b){this.user=b.user;h.prototype.initialize.apply(this,arguments)},markRead:function(){var a=this,b=_.pluck(a.models,"id");DISQUS.api.call("messagesx/markRead.json",{data:{messages:b},method:"POST",success:function(){a.remove(b)}});this.trigger("markRead",b)}}),b=h.extend({PER_PAGE:50,model:_.bind(e.UniqueModel,{},e.Post),url:DISQUS.api.getURL("threads/listPostsThreaded"),initialize:function(b,c){h.prototype.initialize.apply(this,
arguments);this.thread=c.thread;this.order=a.cookies.read("disqus.order")||"popular"},fetch:function(b){b=b||{};this.order==="popular"?a.cookies.erase("disqus.order"):a.cookies.create("disqus.order",this.order);b=_.extend(b,{data:{limit:this.PER_PAGE,thread:this.thread.id,forum:this.thread.get("forum"),order:this.order}});return h.prototype.fetch.call(this,b)},add:function(a,b){_.isArray(a)||(a=[a]);for(var c=[],e=0;e<a.length;e++)this.get(a[e].id)||c.push(a[e]);Backbone.Collection.prototype.add.call(this,
c,b)}}),q=Backbone.Collection.extend({model:e.QueuedPost,initialize:function(a,b){var c=this;c.thread=b.thread;c.counters={comments:0,replies:{}};c.bind("add",function(a){var b=a.getVisibleParent(c.thread);b?(c.counters.replies[b.id]?c.counters.replies[b.id]+=1:c.counters.replies[b.id]=1,b.id==a.get("parentId")&&a.set("immedReply",!0)):c.counters.comments+=1})},comparator:function(a){return parseInt(a.get("id"),10)},isDescendant:function(a,b){var d;var c=a.get("parentId"),c=c?this.get(c):null,e={};
for(_.each(b,function(a){e[a]=!0});c;){if(e[c.get("id")]===!0)return!0;d=(c=c.get("parentId"))?this.get(c):null,c=d}return!1},drain:function(a){function b(a){var c=[];e.each(function(a){a.get("parentId")===null&&c.push(a.get("id"))});e.reset(e.filter(function(b){if(b.get("parentId")!==null&&!e.isDescendant(b,c))return b;a(b)}));e.counters.comments=0}function c(b){var f=[],g=[],g=e.filter(function(b){var c=b.getVisibleParent(e.thread);if(!c||c.get("id")!=a)return b;f.push(b)}),f=_.sortBy(f,function(a){return parseInt(a.get("id"),
10)});_.each(f,function(a){b(a)});e.reset(g);e.counters.replies[a]=0}var e=this;return(a?c:b)(function(a){e.thread.posts.add(a.toPost(e.thread))})}}),j=Backbone.Collection.extend({model:e.Switch,parse:function(a){return _.map(a,function(a,b){return{id:b,enabled:a}})},enabled:function(a){return(a=this.get(a))?a.get("enabled"):!1}}),p=Backbone.Collection.extend({models:e.TypingUser,initialize:function(){var a=this;a.gc=null;a.bind("add remove reset",function(){var b=a.count();if(b>0&&a.gc===null)a.gc=
setInterval(_.bind(a.cleanup,a),6E4);else if(b<=0&&a.gc!==null)clearInterval(a.gc),a.gc=null},a)},count:function(){var a=0;this.each(function(b){a+=b.get("typing")?1:-1});return a},cleanup:function(){var a=moment();this.reset(this.filter(function(b){return b.createdAt.diff(a,"minutes")>5}))}}),o=Backbone.Collection.extend({model:e.ActivityItem,url:DISQUS.api.getURL("users/listActivity"),initialize:function(a,b){this.user=b.user;this.include=b.include||null},fetch:function(){var a={user:"username:"+
this.user.get("username")};if(this.include)a.include=this.include;Backbone.Collection.prototype.fetch.call(this,{data:a})}}),l=h.extend({model:_.bind(e.UniqueModel,{},e.Post),url:DISQUS.api.getURL("users/listPostActivity")}),r=Backbone.Collection.extend({model:e.TopThread,url:DISQUS.api.getURL("threads/listPopular"),initialize:function(a,b){this.forum=b.forum;this.limit=b.limit},add:function(a,b){_.isArray(a)||(a=[a]);var c=[];_.each(a,function(a){a.title.match(/^http/i)||c.push(a)});Backbone.Collection.prototype.add.call(this,
c,b)},fetch:function(){Backbone.Collection.prototype.fetch.call(this,{data:{forum:this.forum,limit:this.limit,interval:"7d",with_top_post:!0}})}}),n=Backbone.Collection.extend({model:e.TopUser,url:DISQUS.api.getURL("forums/listMostActiveUsers"),initialize:function(a,b){this.forum=b.forum;this.limit=b.limit;this.discardLowRep=b.discardLowRep},fetch:function(){Backbone.Collection.prototype.fetch.call(this,{data:{forum:this.forum,limit:this.limit}})},parse:function(a){if(!this.discardLowRep)return a.response;
return _.filter(a.response,function(a){if(parseFloat(a.rep)>0.7)return a})}}),e=h.extend({PER_PAGE:20,model:e.Reaction,url:DISQUS.api.getURL("threads/listReactions"),initialize:function(a,b){this.thread=b.thread},fetch:function(a){a=a||{};a=_.extend(a,{data:{limit:this.PER_PAGE,thread:this.thread.id}});return h.prototype.fetch.call(this,a)}});return{PaginatedCollection:h,UserCollection:i,PostCollection:b,ReactionsCollection:e,TypingUserCollection:p,TopUserCollection:n,TopThreadCollection:r,VoteCollection:g,
ThreadVoteCollection:f,ActivityCollection:o,PostActivityCollection:l,NotificationCollection:c,QueuedPostCollection:q,SwitchCollection:j}});
DISQUS.define("lounge.views",function(){function e(d){return(d=d&&d.match(/discovery\-([\w\-]+)/))&&d[1]}function a(d){return function(a){a&&a.preventDefault&&a.preventDefault();d.apply(this,arguments)}}function f(d,a){var b="[data-action^="+a+"]",c=$(d),c=c.is(b)&&c||c.closest(b);return(c.attr("data-action")||":").split(":")[1]}var i=DISQUS.use("lounge.models"),g=DISQUS.use("lounge.collections"),h=DISQUS.use("lounge.utils"),c=DISQUS.use("lounge.realtime"),b=DISQUS.use("Bus"),q=DISQUS.use("JSON"),
j=DISQUS.strings.get,p,o=1,l={_getShortUrl:function(d){var a=this,b=this._shareUrl(),c=b,b=_.extend({url:b,source:"disqus_embed_next"},this.model.relatedIds());DISQUS.api.call("shortener/create.json",{method:"POST",data:b,timeout:5E3,success:function(d){if(d.code===0)c=d.response.url},complete:function(){d.call(a,c)}})},_shareWaitPopup:function(d){return window.open(DISQUS.urls.loading,"_blank",d||"width=550,height=520")},share:function(d){this.sharers[d].call(this)},sharers:{twitter:function(){var d=
this._shareWaitPopup();this._getShortUrl(function(a){d.location=DISQUS.serialize("https://twitter.com/intent/tweet",{url:a,text:this.model.twitterText(a)})})},facebook:function(){var d=this._shareWaitPopup("width=655,height=352");this._getShortUrl(function(a){d.location=DISQUS.serialize("https://www.facebook.com/sharer.php",{u:a})})}}},r={alert:function(d,a){a?_.isString(a)&&(a={type:a}):a={};this._alert&&this._alert.dismiss();var b=this._alert=new N(_.extend({message:d},a));this.updateDom(function(){b.render().$el.prependTo($("#form")[0])});
return b}},n=Backbone.View.extend({events:{"click [data-action^=auth:]":"handleAuth","click [data-action=verify-email]":"verifyEmail","click [data-action=audiencesync]":"audienceSync","click [data-action=profile]":"handleShowProfile","click [data-action=sort]":"handleSort","click [data-action=logout]":"logout","click [data-action=close-thread]":"closeThread","click [data-action=open-thread]":"openThread","click [data-action=debug]":"renderDebugInfo"},STREAMING_MAX_VISIBLE:250,initialize:function(d){p=
this;d=d||{};d=d.jsonData||{};this.initialData=d.response||{};if(h.extract(d,"response.forum.id"))DISQUS.urls.moderate=h.updateURL(DISQUS.urls.moderate,{hostname:d.response.forum.id+"."});this.theme=h.extract(this.initialData,"theme.base")||{};i.Session.setDefaults(this.initialData.session);this.session=i.Session.get();this.forum=new i.Forum;this.thread=new i.Thread(null,{forum:this.forum,postCursor:d.cursor,moderators:(this.initialData.thread||{}).moderators});this.posts=this.thread.posts;this.switches=
new g.SwitchCollection;this.realtimePool=null;this.renderJobs=[];this.states={templateReady:!1,realtimeIndicatorsCreated:!1,pollingRunning:!1,ravenConfigured:!1,inViewport:!1,streamingPaused:!1};b.bind("window.inViewport",function(){this.states.inViewport=!0;this.trigger("inViewport")},this);b.bind("window.scrollOffViewport",function(){this.states.inViewport=!1},this);b.bind("switches.changed",function(d){this.switches.reset(this.switches.parse(d));if(!this.states.ravenConfigured&&this.switches.enabled("next_raven"))Raven.config({servers:["http://disqus.com/raven/api/store/"],
logger:"javascript.next",ignoreErrors:["Script error."]}),window.onerror=Raven.process,DISQUS.api.defaults({error:function(d){Raven.captureMessage({name:"API call failed.",message:d})}}),this.states.ravenConfigured=!0;if(!this.switches.enabled("next_lazy_embed")||this.states.inViewport)this.initializeSession();else this.on("inViewport",this.initializeSession,this);this.initLinkAffiliator()},this);this.switches.on("reset",function(){DISQUS.defer(_.bind(function(){if(!this.states.templateReady)return!1;
return this.thread&&this.thread.id},this),_.bind(this.poll,this))},this);b.bind("init",function(d){p.bootstrap(d)});d={};if(typeof this.initialData==="object"&&!_.isEmpty(this.initialData))d.thread={id:this.initialData.thread.id};b.sendHostMessage("ready",d)},_templateReady:function(){var d=this.config.customStrings;this.switches.enabled("next_translations")&&d&&(_.each(d,function(d,a,b){b[a]=_.escape(d)}),_.extend(DISQUS.strings.translations,d));this.states.templateReady=!0;this.renderLayout();this.trigger("templateReady")},
bootstrap:function(d){var a=this;a.config=d||{};var c={};if(d.apiKey)c["X-Disqus-Publisher-API-Key"]=d.apiKey;if(d.remoteAuthS3)c["X-Disqus-Remote-Auth"]=d.remoteAuthS3;_.isEmpty(c)||DISQUS.api.defaults({headers:c});d.anchorColor&&function(){var a=h.escapeColor(d.anchorColor);h.addStylesheetRules([[".publisher-anchor-color a",["color",a,!0]],["a.publisher-anchor-color",["color",a,!0]],[".publisher-anchor-hover a:hover",["color",a,!0]],["a.publisher-anchor-hover:hover",["color",a,!0]],[".active .publisher-nav-color:after",
["background",a,!0]],[".media-preview .active.publisher-border-color",["border-color",a,!0]]])}();(function(){var a=document.createElement("base");a.target="_parent";a.href=d.referrer;$("head").append(a)})();if(d.referrer)a.thread.currentUrl=d.referrer;if(d.width)document.body.style.width=d.width+"px";if(d.permalink)a.on("postsRendered",_.once(function(){a.scrollToPost(d.permalink)}));if(d.sso)DISQUS.templateGlobals.sso=d.sso;this.loadTheme(d);a.bind("templateReady",a.renderForm,a);a.bind("templateReady",
a.updatePostCount,a);a.bind("templateReady",a.renderThreadMenu,a);a.bind("templateReady",a.initCommunity,a);a.bind("templateReady",a.initReactions,a);a.bind("templateReady",a.initUserMenu,a);a.bind("templateReady",a.renderStreamingToggle,a);a.renderBindings([a.thread,"change:likes",a.updateThreadVotes],[a.thread,"change:userScore",a.updateThreadUserScore],[a.thread,"change:posts",a.updatePostCount],[a.thread,"change:userSubscription",a.renderThreadMenu],[a.thread.posts,"reset",a.redrawPosts],[a.thread.posts,
"add",a.addPosts],[a.thread.posts,"remove",a.removePost],[a.thread.posts,"reset add",a.toggleLoadMorePosts],[a.thread.posts,"reset add",a.toggleNoPosts],[a.thread.posts,"reset",function(){a.poll()}],[a.thread.reactions,"reset add",a.toggleLoadMoreReactions],[a.session,"change:id",a.updateThreadSessionData],[a.session,"change:id",a.initDashboard],[a.session,"change:id",a.renderThreadMenu],[a.session,"change:id",a.audienceSyncToggle]);a.bind("scroll",function(d){a.position=d;if(a.currentSection==="conversation")a.conversationPosition=
d});a.bind("scrollOffViewport",function(){a.states.realtimeIndicatorsCreated&&a.currentSection==="conversation"&&(b.sendHostMessage("realtime.hideNorth"),b.sendHostMessage("realtime.hideSouth"))});a.bind("scroll",function(d){if(a.states.realtimeIndicatorsCreated&&a.currentSection==="conversation"){var c=_.union([this.queueView],_.values(this.postViews)),e=0,u=0;_.each(c,function(a){if(a&&!a.getDirection)a=a.queueView;if(a&&!(a.options.count<=0)){var b=a.getDirection(d);b===1?e+=a.options.count:b===
-1&&(u+=a.options.count)}});var c="realtime.hideNorth",f;e>0&&(c="realtime.showNorth",f=DISQUS.renderBlock("realtimeIndicatorText",{num:e,orientation:"north"}));b.sendHostMessage(c,f);c="realtime.hideSouth";f=void 0;u>0&&(f=DISQUS.renderBlock("realtimeIndicatorText",{num:u,orientation:"south"}),c="realtime.showSouth");b.sendHostMessage(c,f)}},a);b.bind("window.hashchange",function(d){if(e(d))return void b.sendHostMessage("reset");(d=d&&d.match(/comment\-([0-9]+)/))&&a.scrollToPost(d[1])});b.bind("window.scroll",
function(d){a.trigger("scroll",d)});b.bind("window.scrollOffViewport",function(){a.trigger("scrollOffViewport")});b.bind("window.resize",a.resize,a);b.bind("realtime.click",function(d){b.sendHostMessage("realtime.hide"+(d==="north"?"North":"South"));var c=_.union([a],_.toArray(a.postViews)),e,u,c=_.filter(c,function(b){b=b.queueView;if(!b||b.options.count<=0)return!1;var c=d==="north"?1:-1;if(b.getDirection(a.position)!==c)return!1;return!0}),c=_.sortBy(c,function(d){if(d===a)return 0;return d.offset.top}),
c=d==="north"?_.last(c):_.first(c);e=c.queueView;c===a?(u=0,e.model.queue.drain(),e.setCount(e.model.queue.length)):(u=c.offset.top-100,e.options.thread.queue.drain(e.model.id),e.setCount(e.options.thread.queue.length));var f=function(){b.sendHostMessage("scrollTo",{top:u});n.getInstance().off("domReflow",f)};n.getInstance().on("domReflow",f)});a.thread.queue.bind("add reset",a.toggleRealtimeNotifications,a);a.forum.set(this.initialData.forum);a.thread.set(this.initialData.thread);a.posts.reset(this.initialData.posts);
c=$("body");a.getTypeface()==="serif"&&c.addClass("serif");a.getColorScheme()==="dark"&&c.addClass("dark");b.bind("auth:success",function(d){d&&d.sessionId&&DISQUS.api.defaults({headers:{"X-Sessionid":d.sessionId}});a.refreshSession()});b.bind("audiencesync:grant",function(){if(this._alert)this._alert.remove(),this._alert=null;this.windowClose()},this);b.bind("audiencesync:deny",function(){this.windowClose()},this);_.delay(function H(){a.postViews&&!(_.size(a.postViews)<1)&&(_.invoke(a.postViews,
"updateRelativeTime"),_.delay(H,6E4))},6E4);a.currentSection="conversation";a.thread.on("create",function(d){b.sendHostMessage("posts.create",d.toJSON())});a.initialized=!0},initLinkAffiliator:function(){if(this.switches.enabled("enable_link_affiliation")&&h.extract(this,"initialData.forum.settings.linkAffiliationEnabled")&&!this.initLinkAffiliatorCalled){this.initLinkAffiliatorCalled=!0;var d=h.extract(this,"initialData.forum.pk");if(_.isNumber(d)){var a=new O({el:document.body});b.on("affiliationOptions",
function da(d){b.off("affiliationOptions",da);d&&_.isNumber(d.timeout)&&a.trigger("options.timeout",d.timeout)});b.sendHostMessage("loadLinkAffiliator",{clientUrl:DISQUS.urls.linkAffiliatorClient,apiUrl:"//links.services.disqus.com/api",key:"cfdfcf52dffd0a702a61bad27507376d",id:d})}}},loadTheme:function(d){var a=this.theme.js,b=this.theme.css;d.themeUrl&&(a=d.themeUrl+"/theme.js",b=d.themeUrl+"/theme.css");var d=function(d,a){return DISQUS.serialize((a||"js")+"!"+d,null,DISQUS.debug)},c=this.initialData.forum.language||
"en";this.language=c;var a=curl([d(b,"css"),d(a)]),e=_.bind(this._templateReady,this);c!=="en"&&(a=a.next([d(DISQUS.urls.media+"/build/lang/"+c+".js"),d(DISQUS.urls.media+(DISQUS.debug?"/js/src/lib/moment/lang/":"/build/lang/moment/")+c+".js")]));a.then(e,function(d){e();DISQUS.log(d)})},initializeSession:function(){var d=this;(!d.forum.get("settings").ssoRequired||d.config.remoteAuthS3)&&d.session.fetch({thread:d.thread,complete:function(a){d.session.trigger("identify");d.session.on("authenticated",
d.refreshSession,d);var b=a.discovery||h.extract(a,"theme.discovery");b&&d.initDiscovery(b);b=n.getInstance();h.extract(a,"session.isReadOnly")&&b.alert(j("The Disqus comment system is temporarily in maintenance mode. You can still read comments during this time, however posting comments and other actions are temporarily delayed."))}})},refreshSession:function(){this.session.fetch({thread:this.thread})},initRealtime:function(){var d={width:$("html").width()+"px",position:"fixed"},a={contents:DISQUS.renderBlock("realtimeIndicator",
{orientation:"north"}),styles:{top:"0"}},c={contents:DISQUS.renderBlock("realtimeIndicator",{orientation:"south"}),styles:{bottom:"0"}};_.defaults(a.styles,d);_.defaults(c.styles,d);b.sendHostMessage("realtime.init",{north:a,south:c});this.states.realtimeIndicatorsCreated=!0},insertStreamingComments:_.throttle(function(){var d=this.thread.queue;d.drain();_.each(d.counters.replies,function(a,b){d.drain(b)})},1E3),getTypeface:function(){var d=this.forum.get("settings");return d.typeface==="auto"?this.config.typeface:
d.typeface},getColorScheme:function(){var d=this.forum.get("settings");return d.colorScheme==="auto"?this.config.colorScheme:d.colorScheme},toggleRealtimeNotifications:function(){var d=this,a=d.thread.queue;d.updateDom(function(){_.defer(function(){b.sendHostMessage("fakeScroll")});if(!a.length)return void $("[data-role=realtime-notification]").hide();if(d.thread.get("hasStreaming"))return void d.insertStreamingComments();var c=d.queueView||new C({model:d.thread,el:d.$el.find("button[data-role=realtime-notification]")});
d.queueView=c;c.setCount(a.counters.comments);c.render();_.each(a.counters.replies,function(a,b){var c=d.thread.posts.get(b);if(c){var s=d.postViews[c.cid],e=s.queueView;if(!e)e=new M({thread:d.thread,postView:s,model:c,el:s.$el.find("[data-role=realtime-notification:"+b+"] a")}),s.queueView=e;e.setCount(a);e.render()}})})},renderDebugInfo:a(function(){if(this.session.user.get("isGlobalAdmin")){var d=new P({Shortname:this.thread.get("forum"),"Thread ID":this.thread.get("id"),"Thread slug":this.thread.get("slug"),
"Anchor color":h.escapeColor(this.config.anchorColor)});d.render();this.updateDom(function(){var a=document.body;a.insertBefore(d.el,a.firstChild)})}}),scrollToPost:function(d,a,c){var e=this;e.currentSection!=="conversation"&&(c=!0);e.mainNav.navTo("conversation");var f=e.$el.find("#post-"+d);f.length?(a=a||0,_.delay(function(){b.sendHostMessage("scrollTo",{top:f.offset().top+a,force:c||null})},100)):DISQUS.api.call("posts/getContext.json",{method:"GET",data:{post:d},success:function(b){b=_.filter(b.response,
function(d){return d.thread==e.thread.get("id")});b.length!==0&&(_.each(b,function(d){e.thread.posts.add(new i.UniqueModel(i.Post,d))}),e.on("domReflow",function ga(){e.off("domReflow",ga);e.scrollToPost(d,a,c)}))}})},updateThreadSessionData:function(d){d&&(d.get("thread")&&this.thread.set(d.get("thread")),(d=d.get("votes"))&&typeof d==="object"&&_.each(d,function(d,a){var b=this.posts.get(a);b&&b.set("userScore",d)},this))},initDashboard:function(){var d=$("#main-nav [data-nav=dashboard]");if(this.session.isAnonymous())return d.hide();
d.show();this.notificationCount=new G({el:d.find("[data-role=notification-count]")[0],session:this.session});this.notificationCount.render();this.session.notifications.on("markRead",this.notificationCount.remove,this.notificationCount);this.dashboard=new Q({el:"#dashboard",session:this.session,notifications:this.notifications});this.dashboard.render()},initCommunity:function(){this.community=new R({el:document.getElementById("community"),forum:this.forum})},initReactions:function(){this.reactions=
new ha({el:$("#reaction-list")[0],collection:this.thread.reactions,thread:this.thread,session:this.session});this.forum.get("settings").hasReactions&&$("#global-nav").length===0&&(this.thread.reactions.on("reset",function(){$("#reactions").show()}),this.thread.reactions.fetch())},_getLogoutUrl:function(){return this.config.sso&&this.session.user.get("user_type")==="sso"?this.config.sso.logout:DISQUS.urls.logout},initUserMenu:function(){var d=this.userMenu=new w({el:this.$el.find("[data-role=logout]")[0],
session:this.session,thread:this.thread,showLogin:!this.forum.get("settings").ssoRequired,logoutUrl:this._getLogoutUrl(),referrerUrl:this.config.referrer});this.session.on("change:id",function(){d.logoutUrl=this._getLogoutUrl();d.render()},this);this.thread.on("change:isClosed",this.render,this);d.render()},initDiscovery:function(d){function a(b){if(!h){if(!c.switches.length)return void c.switches.on("reset",function ia(){a(b);c.switches.off("reset",ia)});if(c.switches.enabled("discovery_next"))try{DISQUS.runThemeScript&&
(DISQUS.runThemeScript(),h=!0);var e="discovery";_.contains(["midway-top"],g)&&(e+="-top");DISQUS.discovery.init(_.extend({},c.config,{isExperiment:!!d.isExperiment,variant:g,thread:c.initialData.thread,forum:c.initialData.forum,switches:c.switches,mainEl:document.getElementById(e),session:c.session}),b)}catch(u){return void Raven.captureMessage({name:"There is a bug in Discovery JS. Variant: "+g,message:u})}}}function b(d){d.on("allSubviewsRendered",c.updateDom,c);d.on("resize",c.updateDom,c);c.updateDom(function(){d.render()})}
var c=this;if(!c.states.templateReady)return void c.on("templateReady",function fa(){c.initDiscovery(d);c.off("templateReady",fa)});var f=e(c.config.parentWindowHash);f&&(d={js:d.js.replace(RegExp(d.name+"\\.js$"),f+".js"),css:d.css.replace(RegExp(d.name+"\\.css$"),f+".css"),name:f,isExperiment:!1});var g,h=!1;g=d.name;curl(["css!"+DISQUS.serialize(d.css,null,DISQUS.debug),"js!"+DISQUS.serialize(d.js,null,DISQUS.debug)],function(){a(b)});c.initDiscovery=function(){}},toggleLoadMorePosts:function(){var d=
this.$el.find("#posts [data-role=more]");this.updateDom(function(){d[this.thread.posts.cursor.hasNext?"show":"hide"]()},this)},toggleLoadMoreReactions:function(){var d=this.$el.find("#reactions [data-role=more]");this.updateDom(function(){d[this.thread.reactions.cursor.hasNext?"show":"hide"]()},this)},isHttps:function(){return window.location.protocol==="https:"},isRealtimeEnabled:function(){return this.switches.enabled("next_realtime")&&!this.thread.get("isClosed")&&!this.isHttps()},poll:function(){function d(d){var d=
d.message_body,a=f.thread;if(!f.thread.get("hasStreaming")||!f.states.streamingPaused){if(!d.id)return void DISQUS.logError("RT: no post ID");if(!d.author||!d.author.id)return void DISQUS.logError("RT: no author or author ID");if(!d.author.name||!d.author.email_md5)return void DISQUS.logError("RT: no author name or email hash");if(!d.post||!d.post.message)return void DISQUS.logError("RT: no post message");if(a.posts.get(d.id)||a.queue.get(d.id))return void DISQUS.log("RT: duplicate",d.id);if(d.type!==
"approved"||_.isString(d.type_prev))return void DISQUS.log("RT: unnaproved",d.id);f.thread.incrementPostCount(1);var b=d.post.parent_post.id;if((b=b!=="0"?b:null)&&!a.posts.get(b)&&!a.queue.get(b))return void DISQUS.log("RT: parent is not on this page",d.id);var c=d.author.id,s=a.users.get(c);s||(s=new i.UniqueModel(i.User,{id:c,name:d.author.name,emailHash:d.author.email_md5,isAnonymous:d.author.id==="0"}),d.author.avatar&&s.set("avatar",{cache:d.author.avatar,permalink:d.author.avatar}),a.users.add(s));
a.queue.add({id:d.id,userId:s.get("id"),parentId:b,message:d.post.message})}}function a(d){var b=d.message_body,c=f.thread.posts.get(b.vote.recipient_post_id);b.id&&b.vote&&!(f.session.user.id&&b.vote.voter_id==f.session.user.id)&&c&&(d=c.votes.get(b.id),d||(d=new i.Vote({id:b.id}),c.votes.add(d)),b=c._vote(b.vote.vote,d.get("score")),b!==0&&d.set("score",b))}function b(d){var a=d.message_body,c=f.thread;a.id&&a.vote&&!(f.session.user.id&&a.vote.voter_id==f.session.user.id)&&(d=c.votes.get(a.id),
d||(d=new i.ThreadVote({id:a.id}),c.votes.add(d)),a=c._vote(a.vote.vote,d.get("score")),a!==0&&d.set("score",a))}function e(d){var a=d.message_body,b=f.thread;a.thread_id==b.id&&a.post.parent_post.id&&(a=b.posts.get(a.post.parent_post.id))&&(a.usersTyping.get(d.firehose_id)||(!(a.usersTyping.count()<=0)||d.typing)&&a.usersTyping.add(new i.TypingUser({id:d.firehose_id,typing:d.typing})))}var f=this,g=f.switches.enabled("next_realtime_overlap");if(this.isRealtimeEnabled()){if(g){if(f.realtimePool!==
null)return}else{if(f.states.pollingRunning)return;f.states.pollingRunning=!0}f.switches.enabled("next_realtime_indicators")&&(f.states.realtimeIndicatorsCreated||f.initRealtime());var h=DISQUS.urls.realertime+"/api/2/thread/"+f.thread.id,j;g?(f.realtimePool=new c.Pool(h),f.realtimePool.on("progress",function(c){_.each(c,function(c){switch(c.message_type){case "Post":d(c);break;case "Vote":a(c);break;case "ThreadVote":b(c);break;case "IsTyping":e(c)}})}),_.defer(function(){f.realtimePool.run()})):
(j=new c.Firehose(h),j.on("success",function(){f.states.pollingRunning=!1;o=1;f.poll()}),j.on("error",function(){o<=120&&(o*=2);f.states.pollingRunning=!1;_.delay(_.bind(f.poll,f),o*1E3)}),j.on("progress",function(c){switch(c.message_type){case "Post":d(c);break;case "Vote":a(c);break;case "ThreadVote":b(c);break;case "IsTyping":e(c)}}),_.defer(function(){j.run()}))}},renderBindings:function(){var d=this;_.each(arguments,function(a){var b=a[2];a[0].bind(a[1],function(){var a=arguments;d.states.templateReady?
b.apply(d,a):d.bind("templateReady",function(){b.apply(d,a)})})})},updateDom:function(){var d=_.debounce(function(){this.resize();this.trigger("domReflow")},0);return function(a,b){a&&a.call(b);d.call(this)}}(),audienceSyncToggle:function(){var d;this.needsAudienceSyncAuth()&&(d=DISQUS.interpolate(j("In order to comment, you must %(connectWith)s."),{connectWith:DISQUS.interpolate('<a href="#" data-action="audiencesync">'+j("connect with %(forumName)s")+"</a>",{forumName:this.forum.get("name")})}),
this.alert(d,{safe:!0}))},renderThreadMenu:_.debounce(function(){var d;this.threadMenu&&this.threadMenu.remove();this.threadMenu=d=new y({thread:this.thread,session:this.session});d.on("subscribe:error",_.bind(this.alert,this,j("Please enter a valid e-mail to subscribe."),"error"));d.on("subscribe:true",_.bind(this.alert,this,j("You have subscribed to this thread."),"success"));d.on("subscribe:false",_.bind(this.alert,this,j("You have unsubscribed from this thread."),"success"));d.on("vote:up",_.bind(this.trigger,
this,"uiAction:threadUpvote"));d.on("vote:down",_.bind(this.trigger,this,"uiAction:threadDownvote"));d.render();this.updateDom(function(){$("#thread-votes").append(d.el)})},200),renderStreamingToggle:function(){var d=this;if(d.thread.get("hasStreaming")&&DISQUS.blocks.realtimeToggleButton){var b=$(DISQUS.renderBlock("realtimeToggleButton"));$(b).bind("click",a(function(){d.toggleStreamingRealtime()}));d.updateDom(function(){$("#realtime-toggle").empty();$("#realtime-toggle").append(b[0])})}},toggleStreamingRealtime:function(){var d=
$("#realtime-toggle a.btn");this.states.streamingPaused?(this.states.streamingPaused=!1,d.addClass("pause")):(this.states.streamingPaused=!0,d.removeClass("pause"))},updateThreadVotes:function(){$("#thread-votes [data-role=like-count]").text(this.thread.get("likes"))},updateThreadUserScore:function(){var d=this.thread.get("userScore"),a=$("#thread-votes [data-role=vote-button]");a.removeClass("upvoted").removeClass("downvoted");d>0?a.addClass("upvoted"):d<0&&a.addClass("downvoted")},updatePostCount:function(){$("#post-count").html(DISQUS.renderBlock("postCount",
{count:this.thread.get("posts")}))},swapMain:function(d){var a=this,c=this.$el.find("#main-nav [data-nav=conversation]").parent("li");d!=="conversation"?c.attr("data-dropdown","disabled"):_.defer(function(){c.attr("data-dropdown","enabled")});a.updateDom(function(){a.states.realtimeIndicatorsCreated&&d!="conversation"&&(b.sendHostMessage("realtime.hideNorth"),b.sendHostMessage("realtime.hideSouth"));var c=a[d];c&&!c.isRendered&&(a.freeze(!0),c.on("render:all",_.once(function(){a.freeze(!1)})),c.show());
a.$el.find("[data-role=main]").hide();a.$el.find("[data-role=main]#"+d).show();a.prevSection=a.currentSection;a.currentSection=d});a.trigger("uiAction:navigate",d)},returnToConversation:function(){this.mainNav.navTo("conversation");var d=this.conversationPosition,a=d&&d.pageOffset;a&&this.updateDom(function(){_.delay(function(){b.sendHostMessage("scrollTo",{top:a,relative:"window",force:!0})},100)},this)},setupNavigation:function(){var d=this;d.globalNav=new S({el:d.$el.find("#global-nav")[0]});d.mainNav=
new S({el:d.$el.find("#main-nav")[0]});d.globalNav.on("nav",function(a){d.updateDom(function(){var b=d.$el.find("#form"),c=d.$el.find("#main-nav");switch(a){case "conversation":b.show();c.show();d.swapMain(d.prevSection||a);break;case "reactions":b.hide(),c.hide(),d.swapMain(a)}})});d.mainNav.on("nav",function(a){d.updateDom(function(){d.swapMain(a)})})},renderLayout:function(){function d(d){return function(c){c.preventDefault();var e=$(c.currentTarget);e.addClass("busy");a.thread[d].more({success:function(){e.removeClass("busy")},
error:function(){e.removeClass("busy")}});b.sendHostMessage([d,".paginate"].join(""))}}var a=this;a.setElement($(DISQUS.renderBlock("layout",{thread:_.extend(a.thread.toJSON(),{showReactions:a.forum.get("settings").hasReactions}),order:a.thread.posts.order,showFooter:!0})).appendTo("body"));var c=a.$el;a.setupNavigation();_.each(["posts","reactions"],function(a){c.delegate("[data-action=more-"+a+"]","click",d(a))});a.resize();b.sendHostMessage("mainViewRendered")},renderForm:function(){if(this.thread.get("isClosed"))return void this.alert(j("Comments for this thread are now closed."));
if(!this.session.get("canReply"))return void this.session.on("change:id",function u(){this.session.off("change:id",u);this.renderForm()},this);var d=new m({thread:this.thread,session:this.session});d.render();this.updateDom(function(){$("#form").prepend(d.el);d.resize()},this);this.resize()},toggleNoPosts:function(){this.updateDom(function(){var d=this.thread.posts.models;$("#no-posts")[d.length?"hide":"show"]();$("#post-list").removeClass("loading")},this)},handleShowProfile:a(function(d){d=$(d.currentTarget).attr("data-user");
(d=i.UniqueModel.get(i.User,d))&&this.showProfile(d)}),handleSort:a(function(d){var a=$(d.currentTarget),d=a.closest("li"),a=a.attr("data-sort");d.siblings().removeClass("selected");d.addClass("selected");this.thread.posts.order=a;this.thread.posts.fetch();$("#conversation-menu").removeClass("open");$("#posts [data-role=more]").hide();$("#post-list").addClass("loading").empty()}),logout:a(function(){this.session.logout()}),closeThread:a(function(){this.thread.close({success:_.bind(b.sendHostMessage,
b,"reset"),error:_.bind(this.alert,this,"An error occurred while closing thread. Please try again.","error")})}),openThread:a(function(){this.thread.open({success:_.bind(b.sendHostMessage,b,"reset"),error:_.bind(this.alert,this,"An error occurred while opening thread. Please try again.","error")})}),redrawPosts:function(){var d=this;d.postViews={};d.addPosts(d.thread.posts,{clearDom:!0});_.each(m.open,function(a,b){var c=d.postViews[b];c&&(c.toggleReply(),c.reply.textarea.set(a.textarea.get()))})},
addPosts:_.decorate(Backbone.collectionAddNormalizer(g.PostCollection,i.Post),function(d,a,b){var c=this;if(d.length){var e=[];_.each(d,function(d){var a,s=d.get("parent");s&&(a=(s=c.thread.posts.get(s))&&c.postViews[s.cid]);a=new F({parent:a,model:d,thread:c.thread,session:c.session,created:b.created});c.postViews[d.cid]=a;a.render();d.get("isRealtime")&&c.removeOldPosts.call(c);s?c.postViews[s.cid].attachChild(a):e.push(a.el)});e.length&&c.updateDom(function(){var a=$("#post-list");b.clearDom&&
a.empty();$("#post-list").removeClass("loading");b.created||!d[0].id||d[0].get("isRealtime")?a.prepend(e):a.append(e);c.trigger("postsRendered")})}}),showProfile:function(d){this.profile&&this.profile.remove();var a=this.profile=new I({user:d,session:this.session});this.freeze(!0);this.updateDom(function(){this.mainNav.clear();$("#profile").empty().append(a.el);this.swapMain("profile");a.show()},this);a.bind("close",function(){this.returnToConversation();this.updateDom(function(){a.remove()},this)},
this);a.bind("render:all",_.once(function(){this.freeze(!1)}),this);b.sendHostMessage("scrollTo",{top:0})},removePost:function(d){var a=this.postViews[d.cid];a&&(a.remove(),delete this.postViews[d.cid])},removeOldPosts:_.debounce(function(){if(this.switches&&this.switches.enabled("next_realtime_cap")){var d=_.size(this.postViews)-this.STREAMING_MAX_VISIBLE;if(!(d<=0))for(var a=this.thread.posts.sortBy(function(d){return moment(d.get("createdAt")).valueOf()}),b,c=0,e=0;c<a.length&&e<=d;c++)if((b=this.postViews[a[c].cid])&&
b.childrenNode.children().length===0)this.thread.posts.remove(a[c]),e+=1}},500),resize:function(){var d=$("body").height();if(!this._frozen||!(this._lastHeight&&this._lastHeight>d))this._lastHeight=d,b.sendHostMessage("resize",{height:d})},freeze:function(d){this._frozen=!!d;this._frozen===!1&&this.resize()},getPostView:function(d){return this.postViews[d]},windowOpen:function(d,a,b){var c=this._commonWin;h.isWindowClosed(c)?this._commonWin=window.open(d,"_blank","width="+a+",height="+b):(c.resizeTo(a,
b),c.location.href=d);return this._commonWin},windowClose:function(){var d=this._commonWin;h.isWindowClosed(d)||h.attempt(d.close,d);this._commonWin=null},authenticate:function(d){var a=this.authServices[d];if(!a)return void DISQUS.log("Unknown authentication service: "+d);if(_.isFunction(a))return a.call(this);this.session.on("change:id",this.postAuthHandler,this);this.windowOpen(a.url,a.width,a.height)},postAuthHandler:function(){this.session.off("change:id",this.postAuthHandler,this);this.needsAudienceSyncAuth()?
this.audienceSync():this.windowClose()},handleAuth:a(function(d){this.authenticate(f(d.target,"auth"))}),authServices:{disqus:{url:DISQUS.urls.login,width:460,height:355},twitter:{url:DISQUS.urls.oauth.twitter,width:650,height:680},facebook:{url:DISQUS.urls.oauth.facebook,width:550,height:300},google:{url:DISQUS.urls.oauth.google,width:650,height:440},sso:function(){var d=parseInt(this.config.sso.width||"800",10),a=parseInt(this.config.sso.height||"500",10),c=window.open(this.config.sso.url,"_blank",
"width="+d+",height="+a);(function H(){h.isWindowClosed(c)?b.sendHostMessage("reload"):_.delay(H,500)})()}},verifyEmail:a(function(){var d=DISQUS.serialize(DISQUS.urls.verifyEmail,{f:this.forum.id});window.open(d,"_blank","width=460,height=355")}),needsAudienceSyncAuth:function(){return this.forum.get("settings").audienceSyncEnabled&&this.session.isRegistered()&&!this.session.get("audienceSyncVerified")},getAudienceSyncUrl:_.memoize(function(){return DISQUS.serialize(DISQUS.urls.authorize,{client_id:this.config.apiKey,
scope:"read",response_type:"token",audiencesync:"1"})}),audienceSync:a(function(){this.windowOpen(this.getAudienceSyncUrl(),460,355)})});n.getInstance=function(){return p};_.extend(n.prototype,l);_.extend(n.prototype,r);var k=Backbone.View.extend({updateDom:function(d,a){var b=n.getInstance();b&&b.initialized?b.updateDom(d,a):_.isFunction(d)&&d.call(a)},resize:function(){var d=n.getInstance();d&&d.initialized&&d.resize()}}),y=k.extend({initialize:function(d){_.extend(this,d);this.model=d.thread},
events:{"click [data-action=upvote]":"upvote","click [data-action=downvote]":"downvote","click [data-action=share:twitter]":"_onShare","click [data-action=share:facebook]":"_onShare","click [data-action=subscribe]":"subscribe","click [data-action=unsubscribe]":"unsubscribe","keydown #thread-subscribe-email":"subscribeKeypress","click #thread-subscribe-email":function(d){return d.stop()}},_onShare:a(function(d){if((d=f(d.target,"share"))&&this.sharers[d])p.trigger("uiAction:threadShare",d),this.share(d)}),
render:function(){this.setElement($(DISQUS.renderBlock("threadMenu",{thread:this.thread.toJSON(),user:this.session.toJSON()})))},subscribeKeypress:function(d){if(!(d.key!=="Enter"&&d.keyCode!==13))d=d.target.value,h.validateEmail(d)?(this.$el.find(".dropdown").removeClass("open"),this.subscribe(!0,d)):this.trigger("subscribe:error","email")},upvote:a(function(){this.vote(1)}),downvote:a(function(){this.vote(-1)}),vote:function(d){this.trigger(d===1?"vote:up":"vote:down");var a=this.thread.get("userScore")===
d,b;this.thread.vote(a?0:d);a||(b=this.$el.find(".dropdown"),_.defer(function(){b.addClass("open")}))},subscribe:a(function(d,a){this.thread.subscribe(!0,a);this.trigger("subscribe:true")}),unsubscribe:a(function(){this.thread.subscribe(!1);this.trigger("subscribe:false")}),_shareUrl:function(){return this.thread.url()},remove:function(){this.off();Backbone.View.prototype.remove.call(this)}});_.extend(y.prototype,l);var w=k.extend({initialize:function(d){_.extend(this,d)},render:function(){var d=
DISQUS.renderBlock("userMenu",{user:this.session.toJSON(),thread:this.thread.toJSON(),logoutUrl:this.logoutUrl,showLogin:this.showLogin,feedbackUrl:this.getSurveyMonkeyUrl()});this.updateDom(function(){this.$el.html(d)},this)},getSurveyMonkeyUrl:function(){var d=this.referrerUrl,a=this.session.user.id;return"https://www.surveymonkey.com/s/5RBPTTZ?c="+encodeURIComponent((a?[a,d]:[d]).join(";"))}}),v=new QueuedStorage(Modernizr.localstorage?window.localStorage:DISQUS.lounge.utils.hashStorage,5,"drafts.queue"),
z=function(d){if(!d)throw Error("Cannot instantinate MediaStore without a valid storageKey!");this._storageKey=d;this._store=Modernizr.localstorage?window.localStorage:DISQUS.lounge.utils.hashStorage};_.extend(z.prototype,{getItems:function(){var d=this._store.getItem(this._storageKey);return d&&q.parse(d)||{}},clear:function(){this._store.removeItem(this._storageKey)},getItem:function(d){return this.getItems()[d]},setItem:function(d,a){var b=this.getItems();b[d]=a;this._store.setItem(this._storageKey,
q.stringify(b));return a},removeItem:function(d){var a=this.getItems();if(d in a)return delete a[d],this._store.setItem(this._storageKey,q.stringify(a)),!0;return!1}});var B=k.extend({events:function(){var d={"click [data-action=attach]":"_attachMedia"};window.FormData&&_.extend(d,{dragover:"_dragOn",dragenter:"_dragOn",dragleave:"_dragOff",dragexit:"_dragOff",drop:"_drop"});return d},initialize:function(d){this.owner=d.owner;this.parent=d.parent;this.url=d.url},setElement:function(){var d=k.prototype.setElement.apply(this,
arguments);this.$dragPlaceholder=this.$el.find("[data-role=drag-drop-placeholder]");this.$mediaSelector&&this.$mediaSelector.off();this.$mediaSelector=this.$el.find("input[type=file][data-role=media-upload]");this.$mediaSelector.on("change",_.bind(this._selectorChange,this));return d},_toggleDragPlaceholder:_.throttle(function(d){d?this.$dragPlaceholder.show():this.$dragPlaceholder.hide()},50),_selectorChange:function(d){this.uploadMedia(d.target.files);if(p.switches.enabled("next_dragdrop_nag")&&
d.target.files&&Modernizr.localstorage&&!window.localStorage.getItem("usedDragDrop"))this.owner.alert(j("Did you know you can drag and drop images too? Try it now: drag images below.")).on("dismiss",function(){window.localStorage.setItem("usedDragDrop","1")})},_dragOn:function(d){d.stop();this._toggleDragPlaceholder(!0);this.owner.owner.$el.addClass("expanded")},_dragOff:function(d){d.stop();this._toggleDragPlaceholder(!1)},_drop:function(d){d.stop();window.localStorage.setItem("usedDragDrop","1");
this._toggleDragPlaceholder(!1);this.uploadMedia(d.dataTransfer.files)},_attachMedia:function(d){d.stop();this.$mediaSelector[0].click()},_uploadMediaModern:function(d){for(var a=this,b=new FormData,c=0,e=d[c];e;e=d[++c])e.type.match(/^image\//)&&b.append("attachment",e);b.append("json","true");this.parent&&b.append("id",this.parent.id);var f=h.makeCORSRequest("POST",this.url,function(){if(!(f.readyState!==void 0&&(f.readyState!==4||f.status!==200))){var d=q.parse(f.responseText);d.success?a.owner.addMedia(d.media):
a.owner.alert(d.message,"error")}});f.withCredentials=!0;f.send(b)},_uploadMediaLegacy:function(){var d=this,a=document.createElement("iframe"),b=document.createElement("form"),c=this.$mediaSelector[0];$(c).off();var e=$(c.cloneNode(!0));c.parentNode.replaceChild(e[0],c);e.on("change",_.bind(this._selectorChange,this));this.$mediaSelector=e;a.style.display="none";a.name="uploadFrame"+ +new Date;b.style.display="none";b.target=a.name;b.action=this.url;b.method="post";b.appendChild(a);b.appendChild(c);
if(this.parent)a=document.createElement("input"),a.type="hidden",a.name="id",a.value=this.parent.id,b.appendChild(a);b.enctype="multipart/form-data";b.encoding="multipart/form-data";var f=function(a){a=q.parse(a.data);a.name==="upload"&&($(b).remove(),$(window).off("message",f),a.data.success?d.owner.addMedia(a.data.media):d.owner.alert(a.data.message,"error"))};$(window).on("message",f);this.updateDom(function(){this.$el.append(b);b.submit()},this)},uploadMedia:function(d){this.uploadMedia=this["_uploadMedia"+
(window.FormData?"Modern":"Legacy")];return this.uploadMedia(d)}}),E=k.extend({events:{"click [data-action=detach]":"_detachMedia","click ul[data-role=media-preview-list] [data-action=preview]":"_preview"},initialize:function(d){this.alert=_.bind(d.owner.alert,d.owner);this.owner=d.owner;this.parent=d.parent;this.urls=d.urls;this.uploader=new B({owner:this,parent:this.parent,url:this.urls.add})},setElement:function(){var d=k.prototype.setElement.apply(this,arguments);this.$list=this.$el.find("ul[data-role=media-preview-list]");
this.$expandedArea=this.$el.find("[data-role=media-preview-expanded]");this.expandedImg=this.$el.find("img[data-role=media-preview-expanded-image]")[0];return d},clear:function(){this.$el.addClass("empty");this.$list.empty();this._hidePreview();this.owner.mediaStore&&this.owner.mediaStore.clear()},_$oldPreview:null,_preview:function(d){d.stop();var a=this.$expandedArea,b=this.expandedImg,c=d.currentTarget.href,e=$(d.currentTarget).closest("li");b.src!==c?this.updateDom(function(){b.src=c;a.removeClass("empty");
e.addClass("active");this._$oldPreview&&this._$oldPreview.removeClass("active");this._$oldPreview=e},this):this._hidePreview()},_hidePreview:function(){this.updateDom(function(){this.$expandedArea.addClass("empty");if(this._$oldPreview)this._$oldPreview.removeClass("active"),this._$oldPreview=null;this.expandedImg.src=null},this)},_detachMedia:function(d){d.stop();this.updateDom(function(){this.removeMedia($(d.target).closest("li"))},this)},addMedia:function(d){var a=$(DISQUS.renderBlock("mediaUpload",
{media:d}));this.owner.mediaStore.setItem(d.location,d);a.attr("data-media-id",d.location);this.updateDom(function(){this.$list.append(a);this.$el.removeClass("empty")},this)},removeMedia:function(d){var a=this.owner.mediaStore.getItem(d.attr("data-media-id")),b=this._$oldPreview;if(a){b&&d[0]===b[0]&&this._hidePreview();b={media:q.stringify(a)};if(this.parent)b.id=this.parent.id;(new Image).src=DISQUS.serialize(this.urls.remove,b,!0);this.owner.mediaStore.removeItem(a.location);this.updateDom(function(){d.remove();
this.$list.children().length||this.$el.addClass("empty")},this)}}}),m=k.extend({events:{"click [data-nav]":"showAuthSection","click [name=author-register]":"expandRegister"},initialize:function(d){this.session=d.session;this.parent=d.parent;this.thread=d.thread;this.parentView=d.parentView;this.thread.bind("change:id",function(){this.restoreDraft();if(this.thread.forum.get("settings").allowMedia)this.mediaStore=new z(this.storageKey("media"))},this);this.session.on("change:id",this.redraw,this);this.parent&&
(m.open[this.parent.cid]=this);this.textarea=Modernizr.contenteditable&&!DISQUS.browser.mobile&&(!window.opera||!window.opera.version)?new x({thread:this.thread}):new A;if(this.thread.forum.get("settings").allowMedia){if(d=this.storageKey("media"))this.mediaStore=new z(d);this.mediaUploads=new E({owner:this,parent:this.parent,urls:{add:this.thread.get("uploadAdd"),remove:this.thread.get("uploadRemove")}})}},storageKey:function(d){if(!this.thread.id)return null;return[d||"drafts","thread",this.thread.id,
"parent",this.parent?this.parent.id:0].join(":")},saveDraft:function(){this.storageKey()!==null&&v.setItem(this.storageKey(),q.stringify([this.textarea.get(),(new Date).getTime()]))},getDraft:function(){if(this.storageKey()===null)return null;var d=v.getItem(this.storageKey());if(!d)return null;d=q.parse(d);if(d[1]+86400>(new Date).getTime())return d[0];v.removeItem(this.storageKey());return null},restoreDraft:function(){this.textarea.set(this.getDraft())},updateAvatar:function(){this.$el.find("[data-role=user-avatar]").attr("src",
this.session.user.get("avatar").cache)},expandGuestForm:function(){this.$el.find("[data-role=guest-details]").addClass("expanded")},expandRegister:function(){this.$el.toggleClass("register")},redraw:function(){var d=this.$el.hasClass("expanded"),a=this.el,b=this.$el.find("textarea").val();this.render();this.$el.find("textarea").val(b);d&&this.$el.addClass("expanded");$(a).parent().length!==0&&this.updateDom(function(){a.parentNode.replaceChild(this.el,a)},this)},render:function(){var d=this,a=d.getDraft()||
"";this.setElement($(DISQUS.renderBlock("form",{message:a,parent:d.parent?d.parent.toJSON():null,user:d.session.toJSON(),mediaList:this.mediaStore?_.values(this.mediaStore.getItems()):[],allowAnonPost:d.thread.forum.get("settings").allowAnonPost,allowMedia:d.thread.forum.get("settings").allowMedia})));this.$el.find("form").bind("submit",_.bind(this.submitForm,this));var b=this.textarea;b.setElement(d.$el.find("textarea")[0]);b.render();b.bind("keychange",_.debounce(this.saveDraft,500),this);b.$el.bind("focus",
function(){d.$el.addClass("expanded focus");_.delay(_.bind(d.resize,d),200)});b.$el.bind("blur",function(){b.get()||d.$el.removeClass("focus")});this.mediaUploads&&(this.mediaUploads.setElement(this.$el.find("[data-role=media-preview]")[0]),this.mediaUploads.uploader.setElement(this.$el.find("[data-role=textarea]")[0]));d.$el.find("input[name=author-name]").bind("focus",function(){d.expandGuestForm()});d.typingStart();d.session.get("mustVerifyEmail")&&d._alertMustVerify()},resize:function(){this.textarea.resize()},
showAuthSection:function(d){d&&d.preventDefault&&d.preventDefault();var a=d.currentTarget.getAttribute("data-nav");this.updateDom(function(){var d=this.$el.find("[data-nav]");_.each(d,function(d){$(d.parentNode).removeClass("active")});this.$el.find("[data-nav="+a+"]").parents("*").addClass("active");this.$el.find("section").hide();this.$el.find("[data-tab="+a+"]").show()},this)},focus:function(){this.textarea.focus()},clear:function(){var d=this;d.textarea.clear();d.$el.removeClass("expanded");d.mediaUploads&&
d.mediaUploads.clear();_.delay(function(){d.resize()},200);d.parent?d.$el.hide():d.$el.removeClass("expanded");this.storageKey()&&v.removeItem(this.storageKey())},restore:function(d){var a=this;a.textarea.set(d.get("raw_message"));_.delay(function(){a.resize()},200);a.parent&&a.$el.show()},_alertMustVerify:function(d){this.alert(DISQUS.interpolate(j("%(forumName)s requires you to %(verifyEmail)s before posting"),{forumName:this.thread.forum.get("name"),verifyEmail:'<a href="#" data-action="verify-email">'+
j("verify your email address")+"</a>"}),{safe:!0,type:d?"error":"warn"})},submitForm:function(d){function a(d){d=d.response;/Invalid email address/i.test(d)?b.alert(j("Invalid email address."),"error"):/Missing required argument\: \'email\'/i.test(d)?b.alert(j("Please enter an email address."),"error"):/Unable to create user/i.test(d)?b.alert(j("That email address is already registered with a Disqus account. Log in or enter another email."),"alert"):b.alert(d,"error")}var b=this;d&&d.preventDefault&&
d.preventDefault();if(this._alert)this._alert.remove(),this._alert=null;d=b.$el.find("input[name=author-register]");d=d.length&&d[0].checked;if(b.session.isAnonymous()&&d)return b.session.register({name:b.$el.find("input[name=author-name]").val(),email:b.$el.find("input[name=author-email]").val()},{error:a}),null;return b.createPost()},createPost:function(){var d=this,a={thread:d.thread.id,depth:d.parent?d.parent.get("depth")+1:0,parent:d.parent?d.parent.id:null,raw_message:d.textarea.get()};d.session.isRegistered()?
a.author_id=d.session.user.id:_.extend(a,{author_name:d.$el.find("input[name=author-name]").val(),author_email:d.$el.find("input[name=author-email]").val()});var b=new DISQUS.lounge.models.UniqueModel(DISQUS.lounge.models.Post);if(b.set(a,{error:function(a,b){d.alert(b,"error")}})){var c=null,e=function(a,e){if(e.code===19){if(c)return c.reload();c=new L;c.render();var s=p.getPostView(b.cid);s.el.parentNode.insertBefore(c.el,s.el);c.start();c.bind("submitted",function(){b.save({recaptcha_challenge_field:c.getChallenge(),
recaptcha_response_field:c.getResponse()},{success:function(){c.remove()}})})}else e.code===12&&/verify/.test(e.response)?d._alertMustVerify(!0):_.isString(e.response)&&d.alert(e.response,"error"),d.thread.posts.remove(b),d.restore(b),d.thread.incrementPostCount(-1)};b.on("error",e);b.on("sync",function ea(){d.thread.trigger("create",b);b.off("error",e);b.off("sync",ea)});b.save(a);b.author=d.session.isRegistered()?d.session.user:new i.UniqueModel(i.User,{id:md5(a.author_email),name:a.author_name,
email:a.author_email});d.thread.posts.add(b,{created:!0});d.clear();d.trigger("submitted");d.thread.incrementPostCount(1);p.trigger("uiAction:createPost",b);return b}},remove:function(){this.updateDom(function(){this.$el.remove()},this);this.parent&&(delete m.open[this.parent.cid],this.typingStop())},toggle:function(){this.$el.toggle();this.isOpen()?this.typingStart():this.typingStop()},isOpen:function(){return this.el.style.display!=="none"},typingStart:function(){var a=this;if(a.parent){var b=n.getInstance();
b.switches&&b.switches.enabled("next_realtime")&&_.delay(function(){var b=DISQUS.urls.realertime+"/api/2/typing/",c;h.attempt(function(){c=h.makeCORSRequest("POST",b)});if(c===null)return void DISQUS.log("CORS is not supported by this browser.");var e=q.stringify({typing:!0,forum_url:a.thread.get("forum"),thread_id:a.thread.get("id"),user_id:a.session.user.id||0,parent_post_id:a.parent.get("id")});h.attempt(function(){c.send(e)})},500)}},typingStop:function(){var a=this;if(a.parent){var b=n.getInstance();
b.switches&&b.switches.enabled("next_realtime")&&_.delay(function(){var b=DISQUS.urls.realertime+"/api/2/typing/",c;h.attempt(function(){c=h.makeCORSRequest("POST",b)});if(c===null)return void DISQUS.log("CORS is not supported by this browser.");var e=q.stringify({typing:!1,forum_url:a.thread.get("forum"),thread_id:a.thread.get("id"),user_id:a.session.user.id||0,parent_post_id:a.parent.get("id")});h.attempt(function(){c.send(e)})},500)}}});_.extend(m.prototype,r);m.open=m.open||{};var K=k.extend({initialize:function(a){this.post=
a.post;this.textarea=new A},render:function(){this.setElement($(DISQUS.renderBlock("edit",{post:this.post.toJSON()})));this.$el.find("form").bind("submit",_.bind(this.submitForm,this));var a=this.textarea;a.setElement(this.$el.find("textarea")[0]);a.render()},resize:function(){this.textarea.resize()},submitForm:function(a){a&&a.preventDefault()&&a.preventDefault();var a={raw_message:this.textarea.get()},b=this.post.validate(a);if(b!==void 0)return alert(b);this.trigger("submitted");this.post.save(a,
{success:function(){}})},remove:function(){this.updateDom(function(){this.$el.remove()},this)}}),F=k.extend({initialize:function(a){this.thread=a.thread;this.session=a.session;this.created=!!a.created;this.model.bind("destroy",this.removeAsDeleted,this);this.model.bind("spam",this.removeAsDeleted,this);this.model.bind("change:message",this.stopLoading,this);this.model.bind("change:points",this.updatePoints,this);this.model.bind("change:userScore",this.updateVotes,this);this.model.usersTyping.bind("add remove reset",
this.updateTypingCount,this);this.session.on("change:id",this.updateEditHide,this);this.session.on("change:id",this.updateFooter,this);this.session.on("change:id",this.updateMenu,this);this.model.bind("change",function(){var a=this.model.changedAttributes();(a.id||a.message)&&this.redraw()},this);this.edit=this.reply=null;this.parent=a.parent;this.trackPosition=!1;n.getInstance().on("domReflow",function(){if(this.trackPosition){var a=this.contentNode;this.offset=a.offset();this.dim=a.dim()}else this.offset=
{top:-1,height:-1},this.dim={height:-1,width:-1}},this)},updateTypingCount:function(){this.typingUserView&&this.typingUserView.render()},stopLoading:function(){this.contentNode.find(".loading").removeClass("loading")},updateRelativeTime:function(){this.contentNode.find("[data-role=relative-time]").text(this.model.getRelativeCreatedAt())},updateVotes:function(a){var b=this.contentNode.find("[data-role=voting]"),c=DISQUS.renderBlock("postVotes",{post:{userScore:a.get("userScore"),points:a.get("points"),
likes:a.get("likes"),dislikes:a.get("dislikes")}});this.updateDom(function(){b.html(c)})},updateEditHide:function(){var a=this.contentNode.find("[data-role=edit-hide]"),b=DISQUS.renderBlock("postEditHide",{post:{author:{id:this.model.author.id}},session:{id:this.session.user.id}});this.updateDom(function(){a.html(b)})},updateFooter:function(){var a=this.contentNode.find("footer"),b=DISQUS.renderBlock("postFooter",{post:this.model.toJSON(),session:this.session.toJSON(),thread:this.thread.toJSON()});
this.updateDom(function(){a.html(b)})},updateMenu:function(){var a=this.contentNode.find("[data-role=menu]"),b=DISQUS.renderBlock("postMenu",{session:this.session.toJSON(),post:this.model.toJSON()});this.updateDom(function(){a.html(b)})},updatePoints:function(a){var b=function(a){_.delay(function(){a.addClass("update");_.delay(function(){a.removeClass("update")},1E3)},500)};this.contentNode.find("[data-role=points], [data-role=likes], [data-role=dislikes]").each(function(c){var c=$(c),e=c.html(),
f=a.get(c.attr("data-role")).toString();e!==f&&(c.removeClass("count-"+f),c.removeClass("count-"+e),c.html(f),b(c))})},markSeen:function(){function a(e){var f,g;if(!e)return!1;f=b.offset.top+e.frameOffset.top;g=(g=f>e.pageOffset)&&f+b.dim.height<=e.pageOffset+e.height;if(!g)return!1;b.contentNode.addClass("seen");_.delay(function(){b.contentNode.removeClass("seen");b.contentNode.removeClass("new")},1E4);b.trackPosition=!1;c.off("scroll",a);return!0}var b=this,c=n.getInstance();if(!a(c.position))c.on("scroll",
a,b);c.off("domReflow",b.markSeen)},render:function(){var a=this,b=a.parent&&a.parent.model;a.setElement($(DISQUS.renderBlock("post",{post:a.model.toJSON(),session:a.session.toJSON(),thread:a.thread.toJSON(),loading:!a.model.id,created:a.created,parentAuthorName:b?b.author.get("name"):null})));a.contentNode=a.$el.find("[data-role=post-content]");a.childrenNode=a.$el.find("[data-role=children]");this.highlightSyntax();if(a.model.get("isRealtime"))n.getInstance().switches.enabled("next_realtime_anim_disabled")?
a.contentNode.removeClass("new"):(a.trackPosition=!0,p.on("domReflow",a.markSeen,a));p.on("domReflow",_.once(function(){var b=a.$el.find("[data-role=realtime-notification:"+a.model.id+"] .realtime-replies");a.typingUserView=new T({parentView:a,model:a.model,el:b})}));a.processMentions();a.bindDomEvents();if(b&&!b.get("isDeleted"))a.contextCard=J.create({post:this.parent.model,targetElement:this.$el.find("[data-role=parent-link]")})},highlightSyntax:function(){var a=this.contentNode.find("pre code");
a.length&&a.each(function(a){h.syntaxHighlighter.highlight(a)})},redraw:function(){var a=this.$el;if(!a)throw Error("Old child not found on PostView.redraw");var b=this.childrenNode.children();this.render();this.updateDom(function(){a[0].parentNode.replaceChild(this.el,a[0]);this.childrenNode.append(b)},this)},processMentions:function(){this.contentNode.find("[data-dsq-mention]").each(function(){$(this).addClass("mention")})},attachChild:function(a){var b=a.model;!b.id||b.get("isImmediateReply")?
this.childrenNode.prepend(a.el):this.childrenNode.append(a.el)},toggleReply:function(){if(this.reply)return void this.reply.toggle();this.reply=new m({parentView:this,parent:this.model,thread:this.thread,session:this.options.session});this.reply.bind("submitted",function(){this.reply.$el.hide()},this);this.drawReply()},drawReply:function(){this.reply&&(this.reply.render(),this.updateDom(function(){var a=this.childrenNode[0];a.insertBefore(this.reply.el,a.firstChild);this.reply.focus()},this))},toggleEdit:function(){this.edit?
(this.edit.remove(),this.edit=null,this.contentNode.find("[data-role=message]").show()):(this.edit=new K({post:this.model}),this.edit.render(),this.edit.bind("submitted",this.toggleEdit,this),this.updateDom(function(){var a=this.contentNode.find("[data-role=message]");a[0].parentNode.insertBefore(this.edit.el,a[0]);a.hide();this.edit.resize();(a=n.getInstance())&&a.scrollToPost(this.model.id)},this))},removeAsDeleted:function(){this.redraw()},bindDomEvents:function(){var a=this;a.delegateActions(a.contentNode,
{upvote:function(){a.handleVote(1)},downvote:function(){a.handleVote(-1)},reply:"handleReply",flag:"handleFlag",edit:"handleEdit","delete":"handleDelete",spam:"handleSpam",blacklist:"handleBlacklist",collapse:"handleCollapse",reveal:"handleReveal","share:twitter":"_onShare","share:facebook":"_onShare"});var b=a.$el.find(".hovercard");if(b.length)a.profileCard=D.create({session:a.session,user:a.model.author,targetElement:b})},_onShare:function(a){if(a=f(a.target,"share"))p.trigger("uiAction:postShare",
a),this.share(a)},_shareUrl:function(){return this.thread.url()+"#comment-"+this.model.id},handleBlacklist:function(){if(!this.blacklist){var a=this.blacklist=new U({model:this.model});a.render();a.on("success cancel",function(){this.blacklist.remove();this.blacklist=null},this);this.updateDom(function(){this.contentNode.find("[data-role=blacklist-form]").first().append(a.el)},this)}},handleCollapse:function(){this.updateDom(function(){this.$el.toggleClass("collapsed")},this)},handleVote:function(a){a===
1?p.trigger("uiAction:postUpvote"):a===-1&&p.trigger("uiAction:postDownvote");var b=this.model.get("userScore")===a;this.model.vote(b?0:a);var c=this.contentNode.find("[data-role=voting]");c.removeClass("upvoted").removeClass("downvoted");b||(a>0?c.addClass("upvoted"):a<0&&c.addClass("downvoted"))},remove:function(){this.model.off(null,null,this);this.session.off(null,null,this);Backbone.View.prototype.remove.call(this)},handleReply:function(){this.toggleReply()},handleFlag:function(){window.confirm("Are you sure you want to flag this comment?")&&
this.model.report()},handleEdit:function(){this.toggleEdit()},handleDelete:function(){this.model.destroy()},handleSpam:function(){this.model.spam()},handleReveal:function(){this.model.set("isMinimized",!1);this.redraw()}});_.extend(F.prototype,l);var L=k.extend({render:function(){var a=this;a.setElement($(DISQUS.renderBlock("captcha")));a.$el.bind("submit",function(b){b.preventDefault();a.trigger("submitted")})},start:function(){function a(){b.updateDom(function(){Recaptcha.create("6LdKMrwSAAAAAPPLVhQE9LPRW4LUSZb810_iaa8u",
b.el,{theme:"custom",custom_theme_widget:"recaptcha_widget"});b.$el.show()})}var b=this;typeof Recaptcha==="undefined"?DISQUS.require("//www.google.com/recaptcha/api/js/recaptcha_ajax.js",{},!1,a):a()},getChallenge:function(){return Recaptcha.get_challenge()},getResponse:function(){return Recaptcha.get_response()},reload:function(){Recaptcha.reload()}}),G=k.extend({initialize:function(a){this.session=a.session;this.showZero=a.showZero||!1},render:function(){var a=this.session.get("notificationCount")||
0;this.$el.html("<span>"+a+"</span>");a>0||this.showZero?this.$el.show():this.$el.hide();return this}}),C=Backbone.View.extend({__type__:"QueuedPostView",getDirection:function(a){var b=a.pageOffset,c=this.offset.top+a.frameOffset.top;if(c+this.dim.height<b)return 1;if(c>b+a.height)return-1;return 0},setCount:function(a){this.options.count=a},bindDrain:function(a){if(!this.clickEvent)this.$el.attr("data-action")=="load-queued-posts"?this.$el.bind("click",a):this.$el.delegate("[data-action=load-queued-posts]",
"click",a),this.clickEvent=!0},render:function(){var a=this;if(a.options.count===0)return void a.$el.hide();a.$el.html(DISQUS.renderBlock("realtimeCommentNotification",{comments:a.options.count}));a.bindDrain(function(){a.model.queue.drain();a.setCount(a.model.queue.length);a.render()});n.getInstance().on("domReflow",_.throttle(function(){if(a.options.count!==0)this.offset=a.$el.offset(),this.dim=a.$el.dim()},400),this);a.$el.show()}}),M=C.extend({getDirection:function(a){this.offset=this.options.postView.offset;
this.dim=this.options.postView.dim;a=C.prototype.getDirection.call(this,a);delete this.offset;delete this.dim;return a},render:function(){var a=this,b=a.options.postView;DISQUS.log("Model:",a.model.id);a.options.count===0?(a.$el.hide(),b.trackPosition=!1):(b.trackPosition=!0,a.$el.html(DISQUS.renderBlock("realtimeReplyNotification",{replies:a.options.count})),a.bindDrain(function(){a.options.thread.queue.drain(a.model.id);a.setCount(a.options.thread.queue.length);b.trackPosition=!1;a.render()}),a.$el.show(),
_.delay(function(){a.$el.addClass("reveal")},13))}}),T=Backbone.View.extend({render:function(){var a=this.model.usersTyping.count(),b=this.options.parentView.reply;b&&b.isOpen()&&(a-=1);if(a<=0)return void this.$el.hide();a==1?this.$el.html("One other user is typing&hellip;"):this.$el.html(a+" other users are typing&hellip;");this.$el.show()}}),V=k.extend({tagName:"ul",className:"loading",initialize:function(a){this.collection.bind("reset",this.render,this);this.session=a.session},render:function(){this.updateDom(function(){this.$el.removeClass("loading");
this.$el.empty();this.collection.each(function(a){this.$el.append(DISQUS.renderBlock("activityItem",{activity:a.toJSON(),session:this.session?this.session.toJSON():null}))},this);this.trigger("render")},this);return this}}),Q=k.extend({events:{"click [data-action=network]":"showNetwork","click [data-action=notifications]":"showNotifications"},initialize:function(a){this.network=new W;this.notifications=new X({notifications:a.session.notifications});this.notificationCount=new G({session:a.session,
showZero:!0});this._views={network:this.network,notifications:this.notifications};this.network.on("render:activity",_.bind(this.trigger,this,"render:all"))},render:function(){this.updateDom(function(){this.$el.html(DISQUS.renderBlock("dashboard"))},this);this._tabs={network:this.$el.find("[data-role=network-tab]"),notifications:this.$el.find("[data-role=notifications-tab]")};this.network.setElement(this.$el.find("[data-role=network]"));this.notifications.setElement(this.$el.find("[data-role=notifications]"));
this.notificationCount.setElement(this.$el.find("[data-role=notification-count]"));this.network.render();this.notifications.render();this.notificationCount.render()},show:function(){this.setActiveTab("network")},setActiveTab:function(a){var b=n.getInstance();b.freeze(!0);_.chain(this._tabs).invoke("removeClass","active");this._tabs[a].addClass("active");_.chain(this._views).pluck("$el").invoke("hide");var c=this._views[a];this.updateDom(function(){c.$el.show();b.freeze(!1)},this);c.show&&c.show()},
showNetwork:a(function(){this.setActiveTab("network")}),showNotifications:a(function(){this.setActiveTab("notifications")})}),Y=k.extend({events:{"click [data-action=more]":a(function(){this.trigger("fire")})},setBusy:function(){this.$el.find("[data-action=more]").addClass("busy").removeAttr("disabled")},setReady:function(){this.$el.find("[data-action=more]").removeClass("busy").removeAttr("disabled");this.updateDom(function(){this.$el[this.collection.cursor.hasNext?"show":"hide"]()},this)}}),X=k.extend({initialize:function(a){this.notifications=
a.notifications;this.notifications.on("reset",this.resetNotifications,this);this.notifications.on("add:many",this.addNotifications,this);this._fetched=!1;this.moreButton=new Y({collection:this.notifications});this.moreButton.on("fire",this.loadMore,this)},render:function(){return this.renderLayout()},renderLayout:function(){this.updateDom(function(){this.$el.html(DISQUS.renderBlock("notifications"));this.moreButton.setElement(this.$el.find("[data-role=more-notifications]"));this.$el.addClass("loading")},
this);return this},resetNotifications:function(a){var b=this.$el.find("[data-role=no-notifications]");b.hide();this.$el.removeClass("loading");a.size()===0?b.show():(b.hide(),this.addNotifications.apply(this,arguments))},addNotifications:_.decorate(Backbone.collectionAddNormalizer(g.NotificationCollection,i.Notification),function(a){var b=_.map(a,function(a){return $(DISQUS.renderBlock("notification",{notification:a.toJSON()}))[0]});this.updateDom(function(){this.$el.find("[data-role=entries]").append(b)},
this);this.moreButton.setReady();return this}),show:function(){if(!this._fetched)this.notifications.fetch({success:_.bind(this.notifications.markRead,this.notifications)}),this._fetched=!0},loadMore:function(){this.moreButton.setBusy();this.notifications.more()}}),W=k.extend({initialize:function(){this.posts=new g.PostActivityCollection;this.posts.on("reset",this.resetActivity,this);this.posts.on("add:many",this.addActivity,this);this._fetched=!1;this.moreButton=new Y({collection:this.posts});this.moreButton.on("fire",
this.loadMore,this)},render:function(){return this.renderLayout()},renderLayout:function(){this.updateDom(function(){this.$el.html(DISQUS.renderBlock("networkActivity"));this.moreButton.setElement(this.$el.find("[data-role=more-activity]"));this.$el.addClass("loading")},this);return this},resetActivity:function(a){var b=this.$el.find("[data-role=no-activity]");b.hide();this.$el.removeClass("loading");a.size()===0?b.show():(b.hide(),this.addActivity.apply(this,arguments))},addActivity:_.decorate(Backbone.collectionAddNormalizer(g.PostActivityCollection,
i.Post),function(a){var b=new Backbone.Collection;_.each(a,function(a){var d=b.get(a.get("thread").id)||new i.Thread(_.extend(a.get("thread"),{forum:a.get("forum")}));d.posts.add(a);b.add(d)});var c=b.map(function(a){var d=$(DISQUS.renderBlock("networkActivityThreadEntry",{thread:a.toJSON()})),a=a.posts.map(function(a){return $(DISQUS.renderBlock("networkActivityPostEntry",{post:a.toJSON()}))[0]});d.find("[data-role=posts]").append(a);return d[0]});this.updateDom(function(){this.$el.find("[data-role=entries]").append(c);
this.trigger("render:activity")},this);this.moreButton.setReady();return this}),show:function(){if(!this._fetched)this.posts.fetch(),this._fetched=!0},loadMore:function(){this.moreButton.setBusy();this.posts.more()}}),Z=k.extend({tagName:"ol",className:"loading",initialize:function(){this.collection.bind("reset",function(){this.updateDom(this.render,this)},this)},render:function(){this.updateDom(function(){this.$el.removeClass("loading");this.$el.empty();this.collection.each(function(a){var b=DISQUS.assureOffset(a.get("createdAt"));
this.$el.append(DISQUS.renderBlock("topThread",{id:a.id,title:a.get("title"),url:a.get("link"),numPosts:a.get("postsInInterval"),numLikes:a.get("likes"),timeAgo:moment(b,DISQUS.ISO_8601).fromNow()}))},this);this.trigger("render")},this);this.attachPosts();return this},attachPosts:function(){this.collection.each(function(a){this.renderPost(a)},this)},renderPost:function(a){var b=a.get("topPost");if(b){var c=_.escape(_.strip(b.message)),c=_.truncate(c,160,"&hellip;"),e=DISQUS.renderBlock("topThreadPost",
{message:c,author:b.author});this.updateDom(function(){this.$el.find("[data-role=thread-"+a.id+"] [data-role=top-thread-post]").html(e)},this)}}}),aa=k.extend({tagName:"ol",className:"loading",initialize:function(){this.collection.bind("reset",function(){p.thread.users.add(this.collection.models,{merge:!0});this.updateDom(this.render,this)},this)},render:function(){this.updateDom(function(){this.$el.removeClass("loading");this.$el.empty();this.collection.each(function(a){this.$el.append(DISQUS.renderBlock("topUser",
{user:a.toJSON()}))},this);this.trigger("render")},this);return this}}),R=Backbone.View.extend({initialize:function(a){var b=this;b.forum=a.forum;b.topThreads=new Z({id:"top-threads",collection:new g.TopThreadCollection(null,{forum:b.forum.id,limit:10})});b.topUsers=new aa({id:"top-users",collection:new g.TopUserCollection(null,{forum:b.forum.id,limit:20,discardLowRep:p.switches.enabled("next_discard_low_rep")})});Backbone.when([b.topUsers,"render"],[b.topThreads,"render"]).then(function(){b.isRendered=
!0;b.trigger("render:all")});b.fetched=!1;b.render()},render:function(){this.$el.html(DISQUS.renderBlock("community",{forum:this.forum.toJSON()}));this.$el.find("[data-role=top-threads]").append(this.topThreads.el);this.$el.find("[data-role=top-users]").append(this.topUsers.el);return this},show:function(){if(!this.fetched)this.topThreads.collection.fetch(),this.topUsers.collection.fetch(),this.fetched=!0}}),ha=k.extend({initialize:function(a){this.$el.addClass("loading");this.thread=a.thread;this.session=
a.session;this.collection.on("add reset",this.render,this)},render:function(a,b,c){var e=this,f=(c&&c.index!=null?[e.collection.at(c.index)]:e.collection).map(function(a){a=new ba({model:a,thread:e.thread,session:e.session});a.render();return a.el});e.updateDom(function(){e.$el.removeClass("loading");e.$el.append(f);e.isRendered=!0;e.trigger("render:all")})},show:function(){this.collection.length>0||this.collection.fetch()}}),l={toggleFollow:function(a){a.preventDefault();this.user.get("isFollowing")?
(this.user.unfollow(),$(a.target).removeClass("active")):($(a.target).addClass("active"),this.user.follow(),p.trigger("uiAction:followUser"))}},I=Backbone.View.extend({events:{"click [data-action=close]":"close","click [data-action=toggleFollow]":"toggleFollow"},initialize:function(a){var b=this;b.user=a.user;b.session=a.session;b.user.get("numFollowers")===null&&b.user.fetch({success:function(){b.updateStats()}});b.user.on("change",b.updateStats,b);b.user.on("change:connections",b.updateConnections,
b);b.user.on("change:isFollowing",b.updateActions,b);b.activity=new V({id:"activity",collection:new g.ActivityCollection(null,{user:b.user,include:"user"}),session:b.session});b.activity.on("render",function(){b.isRendered=!0;b.trigger("render:all")});b.render()},updateStats:function(){this.$el.find("[data-role=profile-stats]").html(DISQUS.renderBlock("profileStats",{user:this.user.toJSON()}))},updateActions:function(){this.$el.find("[data-role=actions]").html(DISQUS.renderBlock("profileActions",
{user:this.user.toJSON(),sessionId:this.session.user.id}))},updateConnections:function(){DISQUS.blocks.profileConnections&&this.$el.find("[data-role=connections]").html(DISQUS.renderBlock("profileConnections",{user:this.user.toJSON()}))},close:a(function(){this.trigger("close")}),render:function(){this.$el.empty();this.$el.append(DISQUS.renderBlock("profile",{user:this.user.toJSON(),sessionId:this.session.user.id}));this.$el.find("[data-role=user-activity]").append(this.activity.el)},show:function(){this.activity.collection.fetch()}});
_.extend(I.prototype,l);var t=k.extend({initialize:function(){this._id=_.uniqueId();this._hoverState="out";this._leaveTimeout=this._enterTimeout=null;t.open={}},bindEvents:function(){var a=this;a.$el.bind("mouseover",function(){a.enter()});a.$el.bind("mouseout",function(){a.leave()})},target:function(a){var b=this;a.bind("mouseover",function(){b.enter(a)});a.bind("mouseout",function(){b.leave()})},enter:function(a){var b=this;if(a)this.$target=a;b._leaveTimeout&&clearTimeout(b._leaveTimeout);if(b._hoverState!==
"in")b._hoverState="in",b._enterTimeout=_.delay(function(){b._hoverState==="in"&&b.show();b._enterTimeout=null},t.DELAY_ENTER),t.open[this.uid]=this},leave:function(){var a=this;a._enterTimeout&&clearTimeout(a._enterTimeout);if(a._hoverState!=="out")a._hoverState="out",a._leaveTimeout=_.delay(function(){a._hoverState==="out"&&a.hide();a._leaveTimeout=null},t.DELAY_LEAVE),t.open[this.uid]&&delete t.open[this.uid]},show:function(){this.$target.append(this.el)},hide:function(){this.$el.remove()}},{open:{},
instances:{},DELAY_ENTER:350,DELAY_LEAVE:175,exitAll:function(){_.invoke(t.open,"leave")},create:function(a,b,c,e){var f=t.instances[c];f||(t.instances[c]=f={});c=f[a];c||(c=new e(b),f[a]=c,c.render());c.target(b.targetElement);return c}});(function(){$(document).bind("mouseout",_.debounce(function(a){a=a.relatedTarget||a.toElement;(!a||a.nodeName==="HTML")&&t.exitAll()}),10)})();var D=t.extend({events:{"click [data-action=toggleFollow]":"toggleFollow"},initialize:function(a){var b=this;t.prototype.initialize.call(b,
a);b.session=a.session;b.user=a.user;b.user.on("change:numPosts change:numLikesReceived",_.debounce(function(){b.updateCounters()}));b.user.on("change:isFollowing",function(){b.updateActions()});b.session.on("change:id",function(){b.render()})},render:function(){var a=this.user.toJSON();if(a.about)a.about=_.truncate(a.about,80,"...");this.setElement($(DISQUS.renderBlock("hovercard",{user:a,sessionId:this.session.user.id})));this.bindEvents()},updateCounters:function(){var a=this.$el.find("[data-role=counters]");
this.updateDom(function(){a.html(DISQUS.renderBlock("hovercardCounters",{user:this.user.toJSON(),sessionId:this.session.user.id}))},this)},updateActions:function(){var a=this.$el.find("[data-role=actions]");this.updateDom(function(){a.html(DISQUS.renderBlock("hovercardActions",{user:this.user.toJSON(),sessionId:this.session.user.id}))},this)},show:function(){this.user.get("numLikesReceived")===null&&this.user.fetch();t.prototype.show.call(this)}},{create:function(a){return t.create(a.user.id,a,"ProfileCard",
D)}});_.extend(D.prototype,l);var J=t.extend({initialize:function(a){t.prototype.initialize.call(this,a);this.post=a.post},render:function(){var a=this.post.toJSON();a.excerpt=_.truncate(_.escape(_.strip(a.message),40,"..."));this.setElement($(DISQUS.renderBlock("contextCard",{post:a})));this.bindEvents()}},{create:function(a){if(DISQUS.blocks.contextCard)return t.create(a.post.id,a,"ContextCard",J)}}),ba=k.extend({events:{"click [data-action=remove]":"destroyReaction"},initialize:function(a){this.thread=
a.thread;this.session=a.session;this.session.on("change:id",this.renderMenu,this)},render:function(){this.setElement($(DISQUS.renderBlock("reaction",{reaction:this.model.toJSON(),thread:this.thread.toJSON()})))},renderMenu:function(){var a=this.$el.find("[data-role=menu]"),b=DISQUS.renderBlock("reactionMenu",{thread:this.session.toJSON().thread});this.updateDom(function(){a.html(b)},this)},destroyReaction:function(a){a&&a.preventDefault&&a.preventDefault();this.model.destroy();this.updateDom(function(){this.remove()},
this)}}),N=k.extend({events:{"click [data-action=dismiss]":"dismiss"},initialize:function(a){_.extend(this,a)},render:function(){this.setElement($(DISQUS.renderBlock("alert",{message:this.message,type:this.type,safe:this.safe})));return this},dismiss:function(a){a&&a.preventDefault&&a.preventDefault();this.remove();this.trigger("dismiss")}}),U=k.extend({events:{"click [data-action=cancel]":"cancel"},initialize:function(){var a=this;a.loading=!1;if(!a.model.get("ipAddress"))a.loading=!0,a.model.on("change:ipAddress",
function u(){a.model.off("change:ipAddress",u);a.loading=!1;a.redraw()}),a.model.fetch()},render:function(){var a=this;a.setElement($(DISQUS.renderBlock("blacklist",{loading:this.loading,post:a.model.toJSON()})));a.$el.bind("submit",function(b){b&&b.preventDefault()&&b.preventDefault();a.submit()});return a},redraw:function(){var a=this.el.parentNode;a&&(this.render(),this.updateDom(function(){$(a).empty().append(this.el)},this))},cancel:function(a){a&&a.preventDefault()&&a.preventDefault();this.trigger("cancel")},
submit:function(){var a={},b=this;b.$el.find("input").each(function(){if(this.checked)a[this.name]=this.value});if(!_.isEmpty(a))a.forum=b.model.get("forum"),DISQUS.api.call("blacklists/add.json",{method:"POST",data:a,success:function(){b.trigger("success")}})}}),A=k.extend({events:{keyup:"handleKeychange",paste:"handleKeychange"},render:function(){this.el.tagName==="TEXTAREA"&&this.$el.autoresize({maxHeight:350});this.$el.bind("resize",_.debounce(_.bind(this.updateDom,this,function(){}),300));return this},
resize:function(){this.$el.trigger("paste")},get:function(){return this.$el.val()},set:function(a){this.$el.val(a)},clear:function(){this.set("")},focus:function(){this.el.focus()},handleKeychange:function(){this.trigger("keychange")}}),x=A.extend({events:{keyup:"handleKeychange",paste:"handleKeychange"},initialize:function(a){a=a||{};this.thread=a.thread;this.mentionsCache=new g.UserCollection;this.suggestions=new ca({thread:a.thread,mentions:this.mentionsCache});this.placeholder="";this.suggestions.on("select",
this.insertMention,this);this.reset()},reset:function(){this.anchorOffset=this.anchorNode=null;this.suggestions.clear()},handleKeychange:function(){this.trigger("keychange");this.$el.trigger("resize")},render:function(){var a=this.el.getAttribute("placeholder"),b=this.el.value,c=document.createElement("div");_.extend(c,{className:"textarea",contentEditable:!0,tabIndex:this.el.tabIndex});c.setAttribute("role","textbox");c.setAttribute("aria-multiline","true");c.style.overflow="auto";c.style.maxHeight=
"350px";var e=this.el.parentNode;e.replaceChild(c,this.el);this.setElement(c);this.bindKeyEvents();e.appendChild(this.suggestions.el);this.content=new Editable(this.el,!0);b&&this.set(b);A.prototype.render.call(this);if(a)this.placeholder='<span class="placeholder">'+a+"</span>",this.content.text()||this.$el.html(this.placeholder),this.$el.bind("focus focusin",_.debounce(_.bind(function(){this.isPlaceholder()&&this.set("");this.el.focus()},this)),50),this.$el.bind("blur",_.bind(function(){this.content.text()===
""&&this.setPlaceholder()},this));return this},isPlaceholder:function(){return this.$el.find(".placeholder").length!==0},setPlaceholder:function(){this.$el.html(this.placeholder)},bindKeyEvents:function(){this.$el.bind("keydown",_.bind(function(a){switch(a.keyCode){case 9:this.suggestions.active&&(this.suggestions.select(),a.preventDefault(),a.stopPropagation());break;case 10:case 13:case 38:case 40:this.suggestions.active&&(a.preventDefault(),a.stopPropagation())}},this));var a=_.throttle(_.bind(this.suggest,
this),500);this.$el.bind("keyup",_.bind(function(b){b.preventDefault();b.stopPropagation();this.checkExistingMentions();switch(b.keyCode){case 50:if(!b.shiftKey)break;this.start(b);break;case 10:case 13:this.suggestions.select();break;case 27:this.reset(b);break;case 38:this.suggestions.move("up");break;case 40:this.suggestions.move("down");break;default:a(b)}},this))},start:function(){this.reset();this.suggest()},suggest:function(){this.suggestions.suggest(this.parseSearchTerms())},insertMention:function(a){var b=
this.thread.users.getByCid(a);this.selectSearchString(b);this.mentionsCache.getByCid(a)||this.mentionsCache.add(b);this.content.insertHTML(x.getMentionHtml(b));a=this.$el.find("span[data-cid]");_.each(a,function(a){if(a.contentEditable!==!1)a.contentEditable=!1})},selectSearchString:function(){this.content.selectNodeText(this.anchorNode,this.anchorOffset-1,this.anchorOffset+Editable.normalizeSpace(this.anchorNode.nodeValue.slice(this.anchorOffset)).toLowerCase().length)},get:function(){var a=this,
b=x.isMention;if(this.isPlaceholder())return"";return this.content.text(function(c){return b(c,!0)?a.mentionToText(c):null})},set:function(a){this.content.setText(a);this.resize()},clear:function(){A.prototype.clear.call(this);this.setPlaceholder();_.defer(function(a){a.updateDom(function(){a.el.blur();a.$el.trigger("blur")})},this)},parseSearchTerms:function(){var a=this.content.selectedTextNode(),b=a?a.nodeValue:"",c=Editable.normalizeSpace;if(b){var e=this.content.selectedTextNodeOffset(a),f=Editable.normalizeSpace(b.slice(0,
e).split("").reverse().join("")).indexOf("@");if(f===-1)return null;this.anchorNode=a;this.anchorOffset=e-f;if(a=c(b.slice(this.anchorOffset-1,e)).match(x.MENTIONS_RE))return a[0].slice(1).split(" ");if(f===0)return[""]}},checkExistingMentions:function(){var a=Editable.normalizeSpace,b=this.$el.find("span"),b=_.filter(b,x.isMention),c=this.mentionsCache,e={};_.each(b,function(b){var f=$(b).attr("data-cid"),g=_.reduce(this.content.getTextNodes(b),function(b,c){return b+a(c.nodeValue)},""),h=c.getByCid(f);
h.get("name")!==g?(this.mentionsCache.remove(h),this.content.removeNode(b),this.content.insertHTML(" "),this.reset()):e[f]=b},this);c.each(function(a){e[a.cid]||c.remove(a)})},mentionToText:function(a){a=this.mentionsCache.getByCid($(a).attr("data-cid"));return["@",a.get("username")||a.get("emailHash"),":disqus"].join("")}},{MENTIONS_RE:/@\w+\s?(?:\w+\s?){0,5}(?:\w+)?$/,isMention:function(a,b){var c;do{c=$(a);if(c.hasClass("mention")&&c.attr("data-cid"))return!0;a=a.parentElement}while(b&&a);return!1},
getMentionHtml:function(a){return'<span contenteditable="true"><span contenteditable="false" data-cid="'+a.cid+'" class="mention">'+a.get("name")+"</span></span>&nbsp;"}}),ca=Backbone.View.extend({events:{"click li":"onclick"},initialize:function(a){this.active=!1;this.thread=a.thread;this.mentionsCache=a.mentions},suggest:function(a){a=this.findMatches(a);if(!a||!a.length)return void this.clear();this.active=!0;this.el.innerHTML=DISQUS.renderBlock("suggestions",{users:_.map(a,function(a){return _.extend(a.toJSON(),
{cid:a.cid})})});this.$el.find("li[data-cid]").first().addClass("active")},clear:function(){this.active=!1;this.el.innerHTML=""},onclick:function(a){this.select($(a.currentTarget).attr("data-cid"))},findMatches:function(a){if(a&&a.length){for(var b=RegExp(a.join(" ").replace(/[^\w\s]/,""),"i"),c=ca.MAX_SUGGESTIONS,e=this.thread.users,f=[],g=0,h,a=a.length===1&&a[0]===""?function(){return!0}:function(a){return b.test(a.get("name"))||b.test(h.get("username"))},g=0;g<e.models.length&&f.length<c;g++)h=
e.models[g],this.mentionsCache.getByCid(h.cid)||a(h)&&f.push(h);return f}},select:function(a){this.active&&(a||(a=this.$el.find(".active").attr("data-cid")),this.trigger("select",a),this.clear())},move:function(a){if(this.active){var b=this.$el.find(".active"),a=b[a==="up"?"previous":"next"]();a.length&&a.attr("data-cid")&&(b.removeClass("active"),a.addClass("active"))}}},{MAX_SUGGESTIONS:5}),P=k.extend({tagName:"ul",className:"debug",initialize:function(a){this.values=a},render:function(){this.$el.empty();
_.each(this.values,function(a,b){var c=document.createElement("li");c.innerHTML="<strong>"+b+"</strong>: "+a;this.$el.append(c)},this);return this}}),S=Backbone.View.extend({events:{"click [data-nav]":"_navTo"},initialize:function(){this.prevDestination=this.activeNav()},_navTo:function(a){a.preventDefault();a=$(a.target);a=a.is("[data-nav]")?a:a.closest("[data-nav]");a=a.attr("data-nav");if(this.prevDestination==a)return!1;this.navTo(a)},navTo:function(a){this.prevDestination=a;var b=this.$el.find("[data-nav="+
a+"]").parent();b.siblings("li").removeClass("active");b.addClass("active");this.trigger("nav",a)},activeNav:function(){if(this.prevDestination!=null)return this.prevDestination;return this.$el.find(".active [data-nav]").attr("data-nav")},clear:function(){this.$el.find("li").removeClass("active");this.prevDestination=null}}),O=Backbone.View.extend({events:{"click [rel=nofollow]":"sendLinkForInspection"},initialize:function(){this.link=null;this.busy=!1;this.timeoutId=null;this.timeout=1E3;this.token=
1;this.on("option.timeout",function(a){this.timeout=a})},setLink:function(a){this.link=a;this.$link=$(this.link)},onAffiliatorResponse:function(a){a=a||{};if(a.token==this.token){b.off("affiliateLink",this.onAffilatorResponse);if(a.url)this.link.href=a.url;this.undelegateEvents();this.$link.click()}},sendLinkForInspection:function(a){if(a.currentTarget===this.link)return void a.preventDefault();var c=a.which&&a.which===1||a.button===0;if(a.ctrlKey||a.metaKey||a.altKey||a.shiftKey||!c)return!0;if(this.busy){b.off("affiliateLink");
if(this.timeoutId&&window.clearTimeout)window.clearTimeout(this.timeoutId),this.timeoutId=null;this.token++}this.busy=!0;this.setLink(a.currentTarget);a.preventDefault();b.on("affiliateLink",this.onAffiliatorResponse,this);b.sendHostMessage("affiliateLink",{token:this.token,url:this.link.href});a=_.bind(function(a){this.onAffiliatorResponse({token:a})},this,this.token);this.timeoutId=_.delay(a,this.timeout)}});return{Lounge:n,LoungeSubView:k,PostView:F,PostReplyView:m,PostEditView:K,ReactionView:ba,
UserMenuView:w,ThreadMenuView:y,QueuedPostView:C,QueuedReplyView:M,TypingUserView:T,CommunityView:R,TopThreadCollectionView:Z,TopUserCollectionView:aa,DashboardView:Q,NotificationCollectionView:X,NotificationCountView:G,UserActivityCollectionView:V,NetworkActivityCollectionView:W,ProfileView:I,HoverCard:t,ProfileCard:D,ContextCard:J,CaptchaView:L,OutboundLinkHandler:O,AlertView:N,BlacklistView:U,ContentEditableView:x,DebugInfoView:P}});var _comscore,_gaq;
(function(e){var a="",a="UA-1410476-6",f=e.getElementsByTagName("script")[0],i=f.parentNode,g=e.location.protocol=="https:";_comscore=_comscore||[];_comscore.push({c1:"7",c2:"10137436",c3:"1"});var h=document.createElement("script");h.async=!0;h.src=(g?"https://sb":"http://b")+".scorecardresearch.com/beacon.js";i.insertBefore(h,f);_gaq=_gaq||[];_gaq.push(["_setAccount",a]);_gaq.push(["_setDomainName",".disqus.com"]);e=e.createElement("script");e.type="text/javascript";e.async=!0;e.src=(g?"https://ssl":
"http://www")+".google-analytics.com/ga.js";i.insertBefore(e,f)})(document);
(function(){DISQUS.log=function(){var e=DISQUS.lounge.views.Lounge.getInstance();window.console&&e&&e.switches&&e.switches.enabled("next_logging")&&(window.console.log.apply?window.console.log.apply(window.console,arguments):window.console.log(Array.prototype.slice.call(arguments,0).join(" ")))};DISQUS.logError=function(){var e=DISQUS.lounge.views.Lounge.getInstance(),a=Array.prototype.slice.call(arguments,0);DISQUS.log.apply(DISQUS,a);e.switches&&e.switches.enabled("next_raven")&&e.states.ravenConfigured&&
Raven.captureMessage({name:"DISQUS.logError",message:a.join(" ")})};$(document).ready(function(){function e(){$(".dropdown").removeClass("open")}$("html").bind("click",e);$("body").delegate("[data-toggle]","click",function(a){a.stopPropagation();a.preventDefault();var a=$(a.currentTarget),a=a.closest("."+a.attr("data-toggle")),f=a.attr("data-dropdown")!="disabled"&&!a.hasClass("open");a.attr("data-dropdown","enabled");e();f&&a.addClass("open")});DISQUS.Bus.bind("window.click",e)})})();